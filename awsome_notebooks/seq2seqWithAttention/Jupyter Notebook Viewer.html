<!DOCTYPE html>
<!-- saved from url=(0154)http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Teacher-Forcing-and-Scheduled-Sampling -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Jupyter Notebook Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  
  <meta name="robots" content="noindex,nofollow">
  

  <!--NEW RELIC Start Perf Measurement-->
  
  <!--NREND-->

  <!-- Le styles -->
  <script async="" src="./Jupyter Notebook Viewer_files/analytics.js"></script><script async="" src="./Jupyter Notebook Viewer_files/analytics(1).js"></script><script src="./Jupyter Notebook Viewer_files/MuIIl4I_IVFkxldaVu1mdWee9as.js"></script><link href="./Jupyter Notebook Viewer_files/styles.css" rel="stylesheet">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Le fav and touch icons -->
  <link rel="shortcut icon" href="http://nbviewer.jupyter.org/static/ico/ipynb_icon_16x16.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://nbviewer.jupyter.org/static/ico/apple-touch-icon-144-precomposed.png?v=5a3c9ede93e2a8b8ea9e3f8f3da1a905">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://nbviewer.jupyter.org/static/ico/apple-touch-icon-114-precomposed.png?v=45d86fc8f24dc00638035e1dd7a6d898">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://nbviewer.jupyter.org/static/ico/apple-touch-icon-72-precomposed.png?v=540b5eb0f3cfd25f1439d1c9bd30e15f">
  <link rel="apple-touch-icon-precomposed" href="http://nbviewer.jupyter.org/static/ico/apple-touch-icon-57-precomposed.png?v=225f0590e187e1458625654f10a28f56">
  
  

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Notebook on nbviewer">
  <meta name="twitter:description" content="Check out this Jupyter notebook!">

  
  <meta name="twitter:domain" content="nbviewer.ipython.org">
  <meta name="twitter:image:src" content="http://ipython.org/ipython-doc/dev/_images/ipynb_icon_128x128.png">

  
    <link href="./Jupyter Notebook Viewer_files/notebook.css" rel="stylesheet">
  

  

  
    <script src="./Jupyter Notebook Viewer_files/MathJax.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      init_mathjax = function() {
        if (window.MathJax) {
          // MathJax loaded
          MathJax.Hub.Config({
            TeX: {
              equationNumbers: {
                autoNumber: "AMS",
                useLabelIds: true
              }
            },
            tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"] ],
              displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
              processEscapes: true,
              processEnvironments: true
            },
            displayAlign: 'center',
            "HTML-CSS": {
              styles: {'.MathJax_Display': {"margin": 0}},
              linebreaks: { automatic: true }
            }
          });
          MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
      }
      init_mathjax();
    </script>
  

<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">/*!
 *  Font Awesome 4.7.0 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */
/* FONT PATH
 * -------------------------- */
@font-face {
  font-family: 'FontAwesome';
  src: url(https://unpkg.com/jupyter-js-widgets@2.0.33/dist/674f50d287a8c48dc19ba404d20fe713.eot);
  src: url(https://unpkg.com/jupyter-js-widgets@2.0.33/dist/674f50d287a8c48dc19ba404d20fe713.eot?#iefix&v=4.7.0) format('embedded-opentype'), url(https://unpkg.com/jupyter-js-widgets@2.0.33/dist/af7ae505a9eed503f8b8e6982036873e.woff2) format('woff2'), url(https://unpkg.com/jupyter-js-widgets@2.0.33/dist/fee66e712a8a08eef5805a46892932ad.woff) format('woff'), url(https://unpkg.com/jupyter-js-widgets@2.0.33/dist/b06871f281fee6b241d60582ae9369b9.ttf) format('truetype'), url(https://unpkg.com/jupyter-js-widgets@2.0.33/dist/912ec66d7572ff821749319396470bde.svg#fontawesomeregular) format('svg');
  font-weight: normal;
  font-style: normal;
}
.fa {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
/* makes the font 33% larger relative to the icon container */
.fa-lg {
  font-size: 1.33333333em;
  line-height: 0.75em;
  vertical-align: -15%;
}
.fa-2x {
  font-size: 2em;
}
.fa-3x {
  font-size: 3em;
}
.fa-4x {
  font-size: 4em;
}
.fa-5x {
  font-size: 5em;
}
.fa-fw {
  width: 1.28571429em;
  text-align: center;
}
.fa-ul {
  padding-left: 0;
  margin-left: 2.14285714em;
  list-style-type: none;
}
.fa-ul > li {
  position: relative;
}
.fa-li {
  position: absolute;
  left: -2.14285714em;
  width: 2.14285714em;
  top: 0.14285714em;
  text-align: center;
}
.fa-li.fa-lg {
  left: -1.85714286em;
}
.fa-border {
  padding: .2em .25em .15em;
  border: solid 0.08em #eeeeee;
  border-radius: .1em;
}
.fa-pull-left {
  float: left;
}
.fa-pull-right {
  float: right;
}
.fa.fa-pull-left {
  margin-right: .3em;
}
.fa.fa-pull-right {
  margin-left: .3em;
}
/* Deprecated as of 4.4.0 */
.pull-right {
  float: right;
}
.pull-left {
  float: left;
}
.fa.pull-left {
  margin-right: .3em;
}
.fa.pull-right {
  margin-left: .3em;
}
.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
  animation: fa-spin 2s infinite linear;
}
.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
  animation: fa-spin 1s infinite steps(8);
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
  -ms-transform: rotate(90deg);
  transform: rotate(90deg);
}
.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  transform: rotate(180deg);
}
.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
  -ms-transform: rotate(270deg);
  transform: rotate(270deg);
}
.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
  -ms-transform: scale(-1, 1);
  transform: scale(-1, 1);
}
.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
  -ms-transform: scale(1, -1);
  transform: scale(1, -1);
}
:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical {
  filter: none;
}
.fa-stack {
  position: relative;
  display: inline-block;
  width: 2em;
  height: 2em;
  line-height: 2em;
  vertical-align: middle;
}
.fa-stack-1x,
.fa-stack-2x {
  position: absolute;
  left: 0;
  width: 100%;
  text-align: center;
}
.fa-stack-1x {
  line-height: inherit;
}
.fa-stack-2x {
  font-size: 2em;
}
.fa-inverse {
  color: #ffffff;
}
/* Font Awesome uses the Unicode Private Use Area (PUA) to ensure screen
   readers do not read off random characters that represent icons */
.fa-glass:before {
  content: "\F000";
}
.fa-music:before {
  content: "\F001";
}
.fa-search:before {
  content: "\F002";
}
.fa-envelope-o:before {
  content: "\F003";
}
.fa-heart:before {
  content: "\F004";
}
.fa-star:before {
  content: "\F005";
}
.fa-star-o:before {
  content: "\F006";
}
.fa-user:before {
  content: "\F007";
}
.fa-film:before {
  content: "\F008";
}
.fa-th-large:before {
  content: "\F009";
}
.fa-th:before {
  content: "\F00A";
}
.fa-th-list:before {
  content: "\F00B";
}
.fa-check:before {
  content: "\F00C";
}
.fa-remove:before,
.fa-close:before,
.fa-times:before {
  content: "\F00D";
}
.fa-search-plus:before {
  content: "\F00E";
}
.fa-search-minus:before {
  content: "\F010";
}
.fa-power-off:before {
  content: "\F011";
}
.fa-signal:before {
  content: "\F012";
}
.fa-gear:before,
.fa-cog:before {
  content: "\F013";
}
.fa-trash-o:before {
  content: "\F014";
}
.fa-home:before {
  content: "\F015";
}
.fa-file-o:before {
  content: "\F016";
}
.fa-clock-o:before {
  content: "\F017";
}
.fa-road:before {
  content: "\F018";
}
.fa-download:before {
  content: "\F019";
}
.fa-arrow-circle-o-down:before {
  content: "\F01A";
}
.fa-arrow-circle-o-up:before {
  content: "\F01B";
}
.fa-inbox:before {
  content: "\F01C";
}
.fa-play-circle-o:before {
  content: "\F01D";
}
.fa-rotate-right:before,
.fa-repeat:before {
  content: "\F01E";
}
.fa-refresh:before {
  content: "\F021";
}
.fa-list-alt:before {
  content: "\F022";
}
.fa-lock:before {
  content: "\F023";
}
.fa-flag:before {
  content: "\F024";
}
.fa-headphones:before {
  content: "\F025";
}
.fa-volume-off:before {
  content: "\F026";
}
.fa-volume-down:before {
  content: "\F027";
}
.fa-volume-up:before {
  content: "\F028";
}
.fa-qrcode:before {
  content: "\F029";
}
.fa-barcode:before {
  content: "\F02A";
}
.fa-tag:before {
  content: "\F02B";
}
.fa-tags:before {
  content: "\F02C";
}
.fa-book:before {
  content: "\F02D";
}
.fa-bookmark:before {
  content: "\F02E";
}
.fa-print:before {
  content: "\F02F";
}
.fa-camera:before {
  content: "\F030";
}
.fa-font:before {
  content: "\F031";
}
.fa-bold:before {
  content: "\F032";
}
.fa-italic:before {
  content: "\F033";
}
.fa-text-height:before {
  content: "\F034";
}
.fa-text-width:before {
  content: "\F035";
}
.fa-align-left:before {
  content: "\F036";
}
.fa-align-center:before {
  content: "\F037";
}
.fa-align-right:before {
  content: "\F038";
}
.fa-align-justify:before {
  content: "\F039";
}
.fa-list:before {
  content: "\F03A";
}
.fa-dedent:before,
.fa-outdent:before {
  content: "\F03B";
}
.fa-indent:before {
  content: "\F03C";
}
.fa-video-camera:before {
  content: "\F03D";
}
.fa-photo:before,
.fa-image:before,
.fa-picture-o:before {
  content: "\F03E";
}
.fa-pencil:before {
  content: "\F040";
}
.fa-map-marker:before {
  content: "\F041";
}
.fa-adjust:before {
  content: "\F042";
}
.fa-tint:before {
  content: "\F043";
}
.fa-edit:before,
.fa-pencil-square-o:before {
  content: "\F044";
}
.fa-share-square-o:before {
  content: "\F045";
}
.fa-check-square-o:before {
  content: "\F046";
}
.fa-arrows:before {
  content: "\F047";
}
.fa-step-backward:before {
  content: "\F048";
}
.fa-fast-backward:before {
  content: "\F049";
}
.fa-backward:before {
  content: "\F04A";
}
.fa-play:before {
  content: "\F04B";
}
.fa-pause:before {
  content: "\F04C";
}
.fa-stop:before {
  content: "\F04D";
}
.fa-forward:before {
  content: "\F04E";
}
.fa-fast-forward:before {
  content: "\F050";
}
.fa-step-forward:before {
  content: "\F051";
}
.fa-eject:before {
  content: "\F052";
}
.fa-chevron-left:before {
  content: "\F053";
}
.fa-chevron-right:before {
  content: "\F054";
}
.fa-plus-circle:before {
  content: "\F055";
}
.fa-minus-circle:before {
  content: "\F056";
}
.fa-times-circle:before {
  content: "\F057";
}
.fa-check-circle:before {
  content: "\F058";
}
.fa-question-circle:before {
  content: "\F059";
}
.fa-info-circle:before {
  content: "\F05A";
}
.fa-crosshairs:before {
  content: "\F05B";
}
.fa-times-circle-o:before {
  content: "\F05C";
}
.fa-check-circle-o:before {
  content: "\F05D";
}
.fa-ban:before {
  content: "\F05E";
}
.fa-arrow-left:before {
  content: "\F060";
}
.fa-arrow-right:before {
  content: "\F061";
}
.fa-arrow-up:before {
  content: "\F062";
}
.fa-arrow-down:before {
  content: "\F063";
}
.fa-mail-forward:before,
.fa-share:before {
  content: "\F064";
}
.fa-expand:before {
  content: "\F065";
}
.fa-compress:before {
  content: "\F066";
}
.fa-plus:before {
  content: "\F067";
}
.fa-minus:before {
  content: "\F068";
}
.fa-asterisk:before {
  content: "\F069";
}
.fa-exclamation-circle:before {
  content: "\F06A";
}
.fa-gift:before {
  content: "\F06B";
}
.fa-leaf:before {
  content: "\F06C";
}
.fa-fire:before {
  content: "\F06D";
}
.fa-eye:before {
  content: "\F06E";
}
.fa-eye-slash:before {
  content: "\F070";
}
.fa-warning:before,
.fa-exclamation-triangle:before {
  content: "\F071";
}
.fa-plane:before {
  content: "\F072";
}
.fa-calendar:before {
  content: "\F073";
}
.fa-random:before {
  content: "\F074";
}
.fa-comment:before {
  content: "\F075";
}
.fa-magnet:before {
  content: "\F076";
}
.fa-chevron-up:before {
  content: "\F077";
}
.fa-chevron-down:before {
  content: "\F078";
}
.fa-retweet:before {
  content: "\F079";
}
.fa-shopping-cart:before {
  content: "\F07A";
}
.fa-folder:before {
  content: "\F07B";
}
.fa-folder-open:before {
  content: "\F07C";
}
.fa-arrows-v:before {
  content: "\F07D";
}
.fa-arrows-h:before {
  content: "\F07E";
}
.fa-bar-chart-o:before,
.fa-bar-chart:before {
  content: "\F080";
}
.fa-twitter-square:before {
  content: "\F081";
}
.fa-facebook-square:before {
  content: "\F082";
}
.fa-camera-retro:before {
  content: "\F083";
}
.fa-key:before {
  content: "\F084";
}
.fa-gears:before,
.fa-cogs:before {
  content: "\F085";
}
.fa-comments:before {
  content: "\F086";
}
.fa-thumbs-o-up:before {
  content: "\F087";
}
.fa-thumbs-o-down:before {
  content: "\F088";
}
.fa-star-half:before {
  content: "\F089";
}
.fa-heart-o:before {
  content: "\F08A";
}
.fa-sign-out:before {
  content: "\F08B";
}
.fa-linkedin-square:before {
  content: "\F08C";
}
.fa-thumb-tack:before {
  content: "\F08D";
}
.fa-external-link:before {
  content: "\F08E";
}
.fa-sign-in:before {
  content: "\F090";
}
.fa-trophy:before {
  content: "\F091";
}
.fa-github-square:before {
  content: "\F092";
}
.fa-upload:before {
  content: "\F093";
}
.fa-lemon-o:before {
  content: "\F094";
}
.fa-phone:before {
  content: "\F095";
}
.fa-square-o:before {
  content: "\F096";
}
.fa-bookmark-o:before {
  content: "\F097";
}
.fa-phone-square:before {
  content: "\F098";
}
.fa-twitter:before {
  content: "\F099";
}
.fa-facebook-f:before,
.fa-facebook:before {
  content: "\F09A";
}
.fa-github:before {
  content: "\F09B";
}
.fa-unlock:before {
  content: "\F09C";
}
.fa-credit-card:before {
  content: "\F09D";
}
.fa-feed:before,
.fa-rss:before {
  content: "\F09E";
}
.fa-hdd-o:before {
  content: "\F0A0";
}
.fa-bullhorn:before {
  content: "\F0A1";
}
.fa-bell:before {
  content: "\F0F3";
}
.fa-certificate:before {
  content: "\F0A3";
}
.fa-hand-o-right:before {
  content: "\F0A4";
}
.fa-hand-o-left:before {
  content: "\F0A5";
}
.fa-hand-o-up:before {
  content: "\F0A6";
}
.fa-hand-o-down:before {
  content: "\F0A7";
}
.fa-arrow-circle-left:before {
  content: "\F0A8";
}
.fa-arrow-circle-right:before {
  content: "\F0A9";
}
.fa-arrow-circle-up:before {
  content: "\F0AA";
}
.fa-arrow-circle-down:before {
  content: "\F0AB";
}
.fa-globe:before {
  content: "\F0AC";
}
.fa-wrench:before {
  content: "\F0AD";
}
.fa-tasks:before {
  content: "\F0AE";
}
.fa-filter:before {
  content: "\F0B0";
}
.fa-briefcase:before {
  content: "\F0B1";
}
.fa-arrows-alt:before {
  content: "\F0B2";
}
.fa-group:before,
.fa-users:before {
  content: "\F0C0";
}
.fa-chain:before,
.fa-link:before {
  content: "\F0C1";
}
.fa-cloud:before {
  content: "\F0C2";
}
.fa-flask:before {
  content: "\F0C3";
}
.fa-cut:before,
.fa-scissors:before {
  content: "\F0C4";
}
.fa-copy:before,
.fa-files-o:before {
  content: "\F0C5";
}
.fa-paperclip:before {
  content: "\F0C6";
}
.fa-save:before,
.fa-floppy-o:before {
  content: "\F0C7";
}
.fa-square:before {
  content: "\F0C8";
}
.fa-navicon:before,
.fa-reorder:before,
.fa-bars:before {
  content: "\F0C9";
}
.fa-list-ul:before {
  content: "\F0CA";
}
.fa-list-ol:before {
  content: "\F0CB";
}
.fa-strikethrough:before {
  content: "\F0CC";
}
.fa-underline:before {
  content: "\F0CD";
}
.fa-table:before {
  content: "\F0CE";
}
.fa-magic:before {
  content: "\F0D0";
}
.fa-truck:before {
  content: "\F0D1";
}
.fa-pinterest:before {
  content: "\F0D2";
}
.fa-pinterest-square:before {
  content: "\F0D3";
}
.fa-google-plus-square:before {
  content: "\F0D4";
}
.fa-google-plus:before {
  content: "\F0D5";
}
.fa-money:before {
  content: "\F0D6";
}
.fa-caret-down:before {
  content: "\F0D7";
}
.fa-caret-up:before {
  content: "\F0D8";
}
.fa-caret-left:before {
  content: "\F0D9";
}
.fa-caret-right:before {
  content: "\F0DA";
}
.fa-columns:before {
  content: "\F0DB";
}
.fa-unsorted:before,
.fa-sort:before {
  content: "\F0DC";
}
.fa-sort-down:before,
.fa-sort-desc:before {
  content: "\F0DD";
}
.fa-sort-up:before,
.fa-sort-asc:before {
  content: "\F0DE";
}
.fa-envelope:before {
  content: "\F0E0";
}
.fa-linkedin:before {
  content: "\F0E1";
}
.fa-rotate-left:before,
.fa-undo:before {
  content: "\F0E2";
}
.fa-legal:before,
.fa-gavel:before {
  content: "\F0E3";
}
.fa-dashboard:before,
.fa-tachometer:before {
  content: "\F0E4";
}
.fa-comment-o:before {
  content: "\F0E5";
}
.fa-comments-o:before {
  content: "\F0E6";
}
.fa-flash:before,
.fa-bolt:before {
  content: "\F0E7";
}
.fa-sitemap:before {
  content: "\F0E8";
}
.fa-umbrella:before {
  content: "\F0E9";
}
.fa-paste:before,
.fa-clipboard:before {
  content: "\F0EA";
}
.fa-lightbulb-o:before {
  content: "\F0EB";
}
.fa-exchange:before {
  content: "\F0EC";
}
.fa-cloud-download:before {
  content: "\F0ED";
}
.fa-cloud-upload:before {
  content: "\F0EE";
}
.fa-user-md:before {
  content: "\F0F0";
}
.fa-stethoscope:before {
  content: "\F0F1";
}
.fa-suitcase:before {
  content: "\F0F2";
}
.fa-bell-o:before {
  content: "\F0A2";
}
.fa-coffee:before {
  content: "\F0F4";
}
.fa-cutlery:before {
  content: "\F0F5";
}
.fa-file-text-o:before {
  content: "\F0F6";
}
.fa-building-o:before {
  content: "\F0F7";
}
.fa-hospital-o:before {
  content: "\F0F8";
}
.fa-ambulance:before {
  content: "\F0F9";
}
.fa-medkit:before {
  content: "\F0FA";
}
.fa-fighter-jet:before {
  content: "\F0FB";
}
.fa-beer:before {
  content: "\F0FC";
}
.fa-h-square:before {
  content: "\F0FD";
}
.fa-plus-square:before {
  content: "\F0FE";
}
.fa-angle-double-left:before {
  content: "\F100";
}
.fa-angle-double-right:before {
  content: "\F101";
}
.fa-angle-double-up:before {
  content: "\F102";
}
.fa-angle-double-down:before {
  content: "\F103";
}
.fa-angle-left:before {
  content: "\F104";
}
.fa-angle-right:before {
  content: "\F105";
}
.fa-angle-up:before {
  content: "\F106";
}
.fa-angle-down:before {
  content: "\F107";
}
.fa-desktop:before {
  content: "\F108";
}
.fa-laptop:before {
  content: "\F109";
}
.fa-tablet:before {
  content: "\F10A";
}
.fa-mobile-phone:before,
.fa-mobile:before {
  content: "\F10B";
}
.fa-circle-o:before {
  content: "\F10C";
}
.fa-quote-left:before {
  content: "\F10D";
}
.fa-quote-right:before {
  content: "\F10E";
}
.fa-spinner:before {
  content: "\F110";
}
.fa-circle:before {
  content: "\F111";
}
.fa-mail-reply:before,
.fa-reply:before {
  content: "\F112";
}
.fa-github-alt:before {
  content: "\F113";
}
.fa-folder-o:before {
  content: "\F114";
}
.fa-folder-open-o:before {
  content: "\F115";
}
.fa-smile-o:before {
  content: "\F118";
}
.fa-frown-o:before {
  content: "\F119";
}
.fa-meh-o:before {
  content: "\F11A";
}
.fa-gamepad:before {
  content: "\F11B";
}
.fa-keyboard-o:before {
  content: "\F11C";
}
.fa-flag-o:before {
  content: "\F11D";
}
.fa-flag-checkered:before {
  content: "\F11E";
}
.fa-terminal:before {
  content: "\F120";
}
.fa-code:before {
  content: "\F121";
}
.fa-mail-reply-all:before,
.fa-reply-all:before {
  content: "\F122";
}
.fa-star-half-empty:before,
.fa-star-half-full:before,
.fa-star-half-o:before {
  content: "\F123";
}
.fa-location-arrow:before {
  content: "\F124";
}
.fa-crop:before {
  content: "\F125";
}
.fa-code-fork:before {
  content: "\F126";
}
.fa-unlink:before,
.fa-chain-broken:before {
  content: "\F127";
}
.fa-question:before {
  content: "\F128";
}
.fa-info:before {
  content: "\F129";
}
.fa-exclamation:before {
  content: "\F12A";
}
.fa-superscript:before {
  content: "\F12B";
}
.fa-subscript:before {
  content: "\F12C";
}
.fa-eraser:before {
  content: "\F12D";
}
.fa-puzzle-piece:before {
  content: "\F12E";
}
.fa-microphone:before {
  content: "\F130";
}
.fa-microphone-slash:before {
  content: "\F131";
}
.fa-shield:before {
  content: "\F132";
}
.fa-calendar-o:before {
  content: "\F133";
}
.fa-fire-extinguisher:before {
  content: "\F134";
}
.fa-rocket:before {
  content: "\F135";
}
.fa-maxcdn:before {
  content: "\F136";
}
.fa-chevron-circle-left:before {
  content: "\F137";
}
.fa-chevron-circle-right:before {
  content: "\F138";
}
.fa-chevron-circle-up:before {
  content: "\F139";
}
.fa-chevron-circle-down:before {
  content: "\F13A";
}
.fa-html5:before {
  content: "\F13B";
}
.fa-css3:before {
  content: "\F13C";
}
.fa-anchor:before {
  content: "\F13D";
}
.fa-unlock-alt:before {
  content: "\F13E";
}
.fa-bullseye:before {
  content: "\F140";
}
.fa-ellipsis-h:before {
  content: "\F141";
}
.fa-ellipsis-v:before {
  content: "\F142";
}
.fa-rss-square:before {
  content: "\F143";
}
.fa-play-circle:before {
  content: "\F144";
}
.fa-ticket:before {
  content: "\F145";
}
.fa-minus-square:before {
  content: "\F146";
}
.fa-minus-square-o:before {
  content: "\F147";
}
.fa-level-up:before {
  content: "\F148";
}
.fa-level-down:before {
  content: "\F149";
}
.fa-check-square:before {
  content: "\F14A";
}
.fa-pencil-square:before {
  content: "\F14B";
}
.fa-external-link-square:before {
  content: "\F14C";
}
.fa-share-square:before {
  content: "\F14D";
}
.fa-compass:before {
  content: "\F14E";
}
.fa-toggle-down:before,
.fa-caret-square-o-down:before {
  content: "\F150";
}
.fa-toggle-up:before,
.fa-caret-square-o-up:before {
  content: "\F151";
}
.fa-toggle-right:before,
.fa-caret-square-o-right:before {
  content: "\F152";
}
.fa-euro:before,
.fa-eur:before {
  content: "\F153";
}
.fa-gbp:before {
  content: "\F154";
}
.fa-dollar:before,
.fa-usd:before {
  content: "\F155";
}
.fa-rupee:before,
.fa-inr:before {
  content: "\F156";
}
.fa-cny:before,
.fa-rmb:before,
.fa-yen:before,
.fa-jpy:before {
  content: "\F157";
}
.fa-ruble:before,
.fa-rouble:before,
.fa-rub:before {
  content: "\F158";
}
.fa-won:before,
.fa-krw:before {
  content: "\F159";
}
.fa-bitcoin:before,
.fa-btc:before {
  content: "\F15A";
}
.fa-file:before {
  content: "\F15B";
}
.fa-file-text:before {
  content: "\F15C";
}
.fa-sort-alpha-asc:before {
  content: "\F15D";
}
.fa-sort-alpha-desc:before {
  content: "\F15E";
}
.fa-sort-amount-asc:before {
  content: "\F160";
}
.fa-sort-amount-desc:before {
  content: "\F161";
}
.fa-sort-numeric-asc:before {
  content: "\F162";
}
.fa-sort-numeric-desc:before {
  content: "\F163";
}
.fa-thumbs-up:before {
  content: "\F164";
}
.fa-thumbs-down:before {
  content: "\F165";
}
.fa-youtube-square:before {
  content: "\F166";
}
.fa-youtube:before {
  content: "\F167";
}
.fa-xing:before {
  content: "\F168";
}
.fa-xing-square:before {
  content: "\F169";
}
.fa-youtube-play:before {
  content: "\F16A";
}
.fa-dropbox:before {
  content: "\F16B";
}
.fa-stack-overflow:before {
  content: "\F16C";
}
.fa-instagram:before {
  content: "\F16D";
}
.fa-flickr:before {
  content: "\F16E";
}
.fa-adn:before {
  content: "\F170";
}
.fa-bitbucket:before {
  content: "\F171";
}
.fa-bitbucket-square:before {
  content: "\F172";
}
.fa-tumblr:before {
  content: "\F173";
}
.fa-tumblr-square:before {
  content: "\F174";
}
.fa-long-arrow-down:before {
  content: "\F175";
}
.fa-long-arrow-up:before {
  content: "\F176";
}
.fa-long-arrow-left:before {
  content: "\F177";
}
.fa-long-arrow-right:before {
  content: "\F178";
}
.fa-apple:before {
  content: "\F179";
}
.fa-windows:before {
  content: "\F17A";
}
.fa-android:before {
  content: "\F17B";
}
.fa-linux:before {
  content: "\F17C";
}
.fa-dribbble:before {
  content: "\F17D";
}
.fa-skype:before {
  content: "\F17E";
}
.fa-foursquare:before {
  content: "\F180";
}
.fa-trello:before {
  content: "\F181";
}
.fa-female:before {
  content: "\F182";
}
.fa-male:before {
  content: "\F183";
}
.fa-gittip:before,
.fa-gratipay:before {
  content: "\F184";
}
.fa-sun-o:before {
  content: "\F185";
}
.fa-moon-o:before {
  content: "\F186";
}
.fa-archive:before {
  content: "\F187";
}
.fa-bug:before {
  content: "\F188";
}
.fa-vk:before {
  content: "\F189";
}
.fa-weibo:before {
  content: "\F18A";
}
.fa-renren:before {
  content: "\F18B";
}
.fa-pagelines:before {
  content: "\F18C";
}
.fa-stack-exchange:before {
  content: "\F18D";
}
.fa-arrow-circle-o-right:before {
  content: "\F18E";
}
.fa-arrow-circle-o-left:before {
  content: "\F190";
}
.fa-toggle-left:before,
.fa-caret-square-o-left:before {
  content: "\F191";
}
.fa-dot-circle-o:before {
  content: "\F192";
}
.fa-wheelchair:before {
  content: "\F193";
}
.fa-vimeo-square:before {
  content: "\F194";
}
.fa-turkish-lira:before,
.fa-try:before {
  content: "\F195";
}
.fa-plus-square-o:before {
  content: "\F196";
}
.fa-space-shuttle:before {
  content: "\F197";
}
.fa-slack:before {
  content: "\F198";
}
.fa-envelope-square:before {
  content: "\F199";
}
.fa-wordpress:before {
  content: "\F19A";
}
.fa-openid:before {
  content: "\F19B";
}
.fa-institution:before,
.fa-bank:before,
.fa-university:before {
  content: "\F19C";
}
.fa-mortar-board:before,
.fa-graduation-cap:before {
  content: "\F19D";
}
.fa-yahoo:before {
  content: "\F19E";
}
.fa-google:before {
  content: "\F1A0";
}
.fa-reddit:before {
  content: "\F1A1";
}
.fa-reddit-square:before {
  content: "\F1A2";
}
.fa-stumbleupon-circle:before {
  content: "\F1A3";
}
.fa-stumbleupon:before {
  content: "\F1A4";
}
.fa-delicious:before {
  content: "\F1A5";
}
.fa-digg:before {
  content: "\F1A6";
}
.fa-pied-piper-pp:before {
  content: "\F1A7";
}
.fa-pied-piper-alt:before {
  content: "\F1A8";
}
.fa-drupal:before {
  content: "\F1A9";
}
.fa-joomla:before {
  content: "\F1AA";
}
.fa-language:before {
  content: "\F1AB";
}
.fa-fax:before {
  content: "\F1AC";
}
.fa-building:before {
  content: "\F1AD";
}
.fa-child:before {
  content: "\F1AE";
}
.fa-paw:before {
  content: "\F1B0";
}
.fa-spoon:before {
  content: "\F1B1";
}
.fa-cube:before {
  content: "\F1B2";
}
.fa-cubes:before {
  content: "\F1B3";
}
.fa-behance:before {
  content: "\F1B4";
}
.fa-behance-square:before {
  content: "\F1B5";
}
.fa-steam:before {
  content: "\F1B6";
}
.fa-steam-square:before {
  content: "\F1B7";
}
.fa-recycle:before {
  content: "\F1B8";
}
.fa-automobile:before,
.fa-car:before {
  content: "\F1B9";
}
.fa-cab:before,
.fa-taxi:before {
  content: "\F1BA";
}
.fa-tree:before {
  content: "\F1BB";
}
.fa-spotify:before {
  content: "\F1BC";
}
.fa-deviantart:before {
  content: "\F1BD";
}
.fa-soundcloud:before {
  content: "\F1BE";
}
.fa-database:before {
  content: "\F1C0";
}
.fa-file-pdf-o:before {
  content: "\F1C1";
}
.fa-file-word-o:before {
  content: "\F1C2";
}
.fa-file-excel-o:before {
  content: "\F1C3";
}
.fa-file-powerpoint-o:before {
  content: "\F1C4";
}
.fa-file-photo-o:before,
.fa-file-picture-o:before,
.fa-file-image-o:before {
  content: "\F1C5";
}
.fa-file-zip-o:before,
.fa-file-archive-o:before {
  content: "\F1C6";
}
.fa-file-sound-o:before,
.fa-file-audio-o:before {
  content: "\F1C7";
}
.fa-file-movie-o:before,
.fa-file-video-o:before {
  content: "\F1C8";
}
.fa-file-code-o:before {
  content: "\F1C9";
}
.fa-vine:before {
  content: "\F1CA";
}
.fa-codepen:before {
  content: "\F1CB";
}
.fa-jsfiddle:before {
  content: "\F1CC";
}
.fa-life-bouy:before,
.fa-life-buoy:before,
.fa-life-saver:before,
.fa-support:before,
.fa-life-ring:before {
  content: "\F1CD";
}
.fa-circle-o-notch:before {
  content: "\F1CE";
}
.fa-ra:before,
.fa-resistance:before,
.fa-rebel:before {
  content: "\F1D0";
}
.fa-ge:before,
.fa-empire:before {
  content: "\F1D1";
}
.fa-git-square:before {
  content: "\F1D2";
}
.fa-git:before {
  content: "\F1D3";
}
.fa-y-combinator-square:before,
.fa-yc-square:before,
.fa-hacker-news:before {
  content: "\F1D4";
}
.fa-tencent-weibo:before {
  content: "\F1D5";
}
.fa-qq:before {
  content: "\F1D6";
}
.fa-wechat:before,
.fa-weixin:before {
  content: "\F1D7";
}
.fa-send:before,
.fa-paper-plane:before {
  content: "\F1D8";
}
.fa-send-o:before,
.fa-paper-plane-o:before {
  content: "\F1D9";
}
.fa-history:before {
  content: "\F1DA";
}
.fa-circle-thin:before {
  content: "\F1DB";
}
.fa-header:before {
  content: "\F1DC";
}
.fa-paragraph:before {
  content: "\F1DD";
}
.fa-sliders:before {
  content: "\F1DE";
}
.fa-share-alt:before {
  content: "\F1E0";
}
.fa-share-alt-square:before {
  content: "\F1E1";
}
.fa-bomb:before {
  content: "\F1E2";
}
.fa-soccer-ball-o:before,
.fa-futbol-o:before {
  content: "\F1E3";
}
.fa-tty:before {
  content: "\F1E4";
}
.fa-binoculars:before {
  content: "\F1E5";
}
.fa-plug:before {
  content: "\F1E6";
}
.fa-slideshare:before {
  content: "\F1E7";
}
.fa-twitch:before {
  content: "\F1E8";
}
.fa-yelp:before {
  content: "\F1E9";
}
.fa-newspaper-o:before {
  content: "\F1EA";
}
.fa-wifi:before {
  content: "\F1EB";
}
.fa-calculator:before {
  content: "\F1EC";
}
.fa-paypal:before {
  content: "\F1ED";
}
.fa-google-wallet:before {
  content: "\F1EE";
}
.fa-cc-visa:before {
  content: "\F1F0";
}
.fa-cc-mastercard:before {
  content: "\F1F1";
}
.fa-cc-discover:before {
  content: "\F1F2";
}
.fa-cc-amex:before {
  content: "\F1F3";
}
.fa-cc-paypal:before {
  content: "\F1F4";
}
.fa-cc-stripe:before {
  content: "\F1F5";
}
.fa-bell-slash:before {
  content: "\F1F6";
}
.fa-bell-slash-o:before {
  content: "\F1F7";
}
.fa-trash:before {
  content: "\F1F8";
}
.fa-copyright:before {
  content: "\F1F9";
}
.fa-at:before {
  content: "\F1FA";
}
.fa-eyedropper:before {
  content: "\F1FB";
}
.fa-paint-brush:before {
  content: "\F1FC";
}
.fa-birthday-cake:before {
  content: "\F1FD";
}
.fa-area-chart:before {
  content: "\F1FE";
}
.fa-pie-chart:before {
  content: "\F200";
}
.fa-line-chart:before {
  content: "\F201";
}
.fa-lastfm:before {
  content: "\F202";
}
.fa-lastfm-square:before {
  content: "\F203";
}
.fa-toggle-off:before {
  content: "\F204";
}
.fa-toggle-on:before {
  content: "\F205";
}
.fa-bicycle:before {
  content: "\F206";
}
.fa-bus:before {
  content: "\F207";
}
.fa-ioxhost:before {
  content: "\F208";
}
.fa-angellist:before {
  content: "\F209";
}
.fa-cc:before {
  content: "\F20A";
}
.fa-shekel:before,
.fa-sheqel:before,
.fa-ils:before {
  content: "\F20B";
}
.fa-meanpath:before {
  content: "\F20C";
}
.fa-buysellads:before {
  content: "\F20D";
}
.fa-connectdevelop:before {
  content: "\F20E";
}
.fa-dashcube:before {
  content: "\F210";
}
.fa-forumbee:before {
  content: "\F211";
}
.fa-leanpub:before {
  content: "\F212";
}
.fa-sellsy:before {
  content: "\F213";
}
.fa-shirtsinbulk:before {
  content: "\F214";
}
.fa-simplybuilt:before {
  content: "\F215";
}
.fa-skyatlas:before {
  content: "\F216";
}
.fa-cart-plus:before {
  content: "\F217";
}
.fa-cart-arrow-down:before {
  content: "\F218";
}
.fa-diamond:before {
  content: "\F219";
}
.fa-ship:before {
  content: "\F21A";
}
.fa-user-secret:before {
  content: "\F21B";
}
.fa-motorcycle:before {
  content: "\F21C";
}
.fa-street-view:before {
  content: "\F21D";
}
.fa-heartbeat:before {
  content: "\F21E";
}
.fa-venus:before {
  content: "\F221";
}
.fa-mars:before {
  content: "\F222";
}
.fa-mercury:before {
  content: "\F223";
}
.fa-intersex:before,
.fa-transgender:before {
  content: "\F224";
}
.fa-transgender-alt:before {
  content: "\F225";
}
.fa-venus-double:before {
  content: "\F226";
}
.fa-mars-double:before {
  content: "\F227";
}
.fa-venus-mars:before {
  content: "\F228";
}
.fa-mars-stroke:before {
  content: "\F229";
}
.fa-mars-stroke-v:before {
  content: "\F22A";
}
.fa-mars-stroke-h:before {
  content: "\F22B";
}
.fa-neuter:before {
  content: "\F22C";
}
.fa-genderless:before {
  content: "\F22D";
}
.fa-facebook-official:before {
  content: "\F230";
}
.fa-pinterest-p:before {
  content: "\F231";
}
.fa-whatsapp:before {
  content: "\F232";
}
.fa-server:before {
  content: "\F233";
}
.fa-user-plus:before {
  content: "\F234";
}
.fa-user-times:before {
  content: "\F235";
}
.fa-hotel:before,
.fa-bed:before {
  content: "\F236";
}
.fa-viacoin:before {
  content: "\F237";
}
.fa-train:before {
  content: "\F238";
}
.fa-subway:before {
  content: "\F239";
}
.fa-medium:before {
  content: "\F23A";
}
.fa-yc:before,
.fa-y-combinator:before {
  content: "\F23B";
}
.fa-optin-monster:before {
  content: "\F23C";
}
.fa-opencart:before {
  content: "\F23D";
}
.fa-expeditedssl:before {
  content: "\F23E";
}
.fa-battery-4:before,
.fa-battery:before,
.fa-battery-full:before {
  content: "\F240";
}
.fa-battery-3:before,
.fa-battery-three-quarters:before {
  content: "\F241";
}
.fa-battery-2:before,
.fa-battery-half:before {
  content: "\F242";
}
.fa-battery-1:before,
.fa-battery-quarter:before {
  content: "\F243";
}
.fa-battery-0:before,
.fa-battery-empty:before {
  content: "\F244";
}
.fa-mouse-pointer:before {
  content: "\F245";
}
.fa-i-cursor:before {
  content: "\F246";
}
.fa-object-group:before {
  content: "\F247";
}
.fa-object-ungroup:before {
  content: "\F248";
}
.fa-sticky-note:before {
  content: "\F249";
}
.fa-sticky-note-o:before {
  content: "\F24A";
}
.fa-cc-jcb:before {
  content: "\F24B";
}
.fa-cc-diners-club:before {
  content: "\F24C";
}
.fa-clone:before {
  content: "\F24D";
}
.fa-balance-scale:before {
  content: "\F24E";
}
.fa-hourglass-o:before {
  content: "\F250";
}
.fa-hourglass-1:before,
.fa-hourglass-start:before {
  content: "\F251";
}
.fa-hourglass-2:before,
.fa-hourglass-half:before {
  content: "\F252";
}
.fa-hourglass-3:before,
.fa-hourglass-end:before {
  content: "\F253";
}
.fa-hourglass:before {
  content: "\F254";
}
.fa-hand-grab-o:before,
.fa-hand-rock-o:before {
  content: "\F255";
}
.fa-hand-stop-o:before,
.fa-hand-paper-o:before {
  content: "\F256";
}
.fa-hand-scissors-o:before {
  content: "\F257";
}
.fa-hand-lizard-o:before {
  content: "\F258";
}
.fa-hand-spock-o:before {
  content: "\F259";
}
.fa-hand-pointer-o:before {
  content: "\F25A";
}
.fa-hand-peace-o:before {
  content: "\F25B";
}
.fa-trademark:before {
  content: "\F25C";
}
.fa-registered:before {
  content: "\F25D";
}
.fa-creative-commons:before {
  content: "\F25E";
}
.fa-gg:before {
  content: "\F260";
}
.fa-gg-circle:before {
  content: "\F261";
}
.fa-tripadvisor:before {
  content: "\F262";
}
.fa-odnoklassniki:before {
  content: "\F263";
}
.fa-odnoklassniki-square:before {
  content: "\F264";
}
.fa-get-pocket:before {
  content: "\F265";
}
.fa-wikipedia-w:before {
  content: "\F266";
}
.fa-safari:before {
  content: "\F267";
}
.fa-chrome:before {
  content: "\F268";
}
.fa-firefox:before {
  content: "\F269";
}
.fa-opera:before {
  content: "\F26A";
}
.fa-internet-explorer:before {
  content: "\F26B";
}
.fa-tv:before,
.fa-television:before {
  content: "\F26C";
}
.fa-contao:before {
  content: "\F26D";
}
.fa-500px:before {
  content: "\F26E";
}
.fa-amazon:before {
  content: "\F270";
}
.fa-calendar-plus-o:before {
  content: "\F271";
}
.fa-calendar-minus-o:before {
  content: "\F272";
}
.fa-calendar-times-o:before {
  content: "\F273";
}
.fa-calendar-check-o:before {
  content: "\F274";
}
.fa-industry:before {
  content: "\F275";
}
.fa-map-pin:before {
  content: "\F276";
}
.fa-map-signs:before {
  content: "\F277";
}
.fa-map-o:before {
  content: "\F278";
}
.fa-map:before {
  content: "\F279";
}
.fa-commenting:before {
  content: "\F27A";
}
.fa-commenting-o:before {
  content: "\F27B";
}
.fa-houzz:before {
  content: "\F27C";
}
.fa-vimeo:before {
  content: "\F27D";
}
.fa-black-tie:before {
  content: "\F27E";
}
.fa-fonticons:before {
  content: "\F280";
}
.fa-reddit-alien:before {
  content: "\F281";
}
.fa-edge:before {
  content: "\F282";
}
.fa-credit-card-alt:before {
  content: "\F283";
}
.fa-codiepie:before {
  content: "\F284";
}
.fa-modx:before {
  content: "\F285";
}
.fa-fort-awesome:before {
  content: "\F286";
}
.fa-usb:before {
  content: "\F287";
}
.fa-product-hunt:before {
  content: "\F288";
}
.fa-mixcloud:before {
  content: "\F289";
}
.fa-scribd:before {
  content: "\F28A";
}
.fa-pause-circle:before {
  content: "\F28B";
}
.fa-pause-circle-o:before {
  content: "\F28C";
}
.fa-stop-circle:before {
  content: "\F28D";
}
.fa-stop-circle-o:before {
  content: "\F28E";
}
.fa-shopping-bag:before {
  content: "\F290";
}
.fa-shopping-basket:before {
  content: "\F291";
}
.fa-hashtag:before {
  content: "\F292";
}
.fa-bluetooth:before {
  content: "\F293";
}
.fa-bluetooth-b:before {
  content: "\F294";
}
.fa-percent:before {
  content: "\F295";
}
.fa-gitlab:before {
  content: "\F296";
}
.fa-wpbeginner:before {
  content: "\F297";
}
.fa-wpforms:before {
  content: "\F298";
}
.fa-envira:before {
  content: "\F299";
}
.fa-universal-access:before {
  content: "\F29A";
}
.fa-wheelchair-alt:before {
  content: "\F29B";
}
.fa-question-circle-o:before {
  content: "\F29C";
}
.fa-blind:before {
  content: "\F29D";
}
.fa-audio-description:before {
  content: "\F29E";
}
.fa-volume-control-phone:before {
  content: "\F2A0";
}
.fa-braille:before {
  content: "\F2A1";
}
.fa-assistive-listening-systems:before {
  content: "\F2A2";
}
.fa-asl-interpreting:before,
.fa-american-sign-language-interpreting:before {
  content: "\F2A3";
}
.fa-deafness:before,
.fa-hard-of-hearing:before,
.fa-deaf:before {
  content: "\F2A4";
}
.fa-glide:before {
  content: "\F2A5";
}
.fa-glide-g:before {
  content: "\F2A6";
}
.fa-signing:before,
.fa-sign-language:before {
  content: "\F2A7";
}
.fa-low-vision:before {
  content: "\F2A8";
}
.fa-viadeo:before {
  content: "\F2A9";
}
.fa-viadeo-square:before {
  content: "\F2AA";
}
.fa-snapchat:before {
  content: "\F2AB";
}
.fa-snapchat-ghost:before {
  content: "\F2AC";
}
.fa-snapchat-square:before {
  content: "\F2AD";
}
.fa-pied-piper:before {
  content: "\F2AE";
}
.fa-first-order:before {
  content: "\F2B0";
}
.fa-yoast:before {
  content: "\F2B1";
}
.fa-themeisle:before {
  content: "\F2B2";
}
.fa-google-plus-circle:before,
.fa-google-plus-official:before {
  content: "\F2B3";
}
.fa-fa:before,
.fa-font-awesome:before {
  content: "\F2B4";
}
.fa-handshake-o:before {
  content: "\F2B5";
}
.fa-envelope-open:before {
  content: "\F2B6";
}
.fa-envelope-open-o:before {
  content: "\F2B7";
}
.fa-linode:before {
  content: "\F2B8";
}
.fa-address-book:before {
  content: "\F2B9";
}
.fa-address-book-o:before {
  content: "\F2BA";
}
.fa-vcard:before,
.fa-address-card:before {
  content: "\F2BB";
}
.fa-vcard-o:before,
.fa-address-card-o:before {
  content: "\F2BC";
}
.fa-user-circle:before {
  content: "\F2BD";
}
.fa-user-circle-o:before {
  content: "\F2BE";
}
.fa-user-o:before {
  content: "\F2C0";
}
.fa-id-badge:before {
  content: "\F2C1";
}
.fa-drivers-license:before,
.fa-id-card:before {
  content: "\F2C2";
}
.fa-drivers-license-o:before,
.fa-id-card-o:before {
  content: "\F2C3";
}
.fa-quora:before {
  content: "\F2C4";
}
.fa-free-code-camp:before {
  content: "\F2C5";
}
.fa-telegram:before {
  content: "\F2C6";
}
.fa-thermometer-4:before,
.fa-thermometer:before,
.fa-thermometer-full:before {
  content: "\F2C7";
}
.fa-thermometer-3:before,
.fa-thermometer-three-quarters:before {
  content: "\F2C8";
}
.fa-thermometer-2:before,
.fa-thermometer-half:before {
  content: "\F2C9";
}
.fa-thermometer-1:before,
.fa-thermometer-quarter:before {
  content: "\F2CA";
}
.fa-thermometer-0:before,
.fa-thermometer-empty:before {
  content: "\F2CB";
}
.fa-shower:before {
  content: "\F2CC";
}
.fa-bathtub:before,
.fa-s15:before,
.fa-bath:before {
  content: "\F2CD";
}
.fa-podcast:before {
  content: "\F2CE";
}
.fa-window-maximize:before {
  content: "\F2D0";
}
.fa-window-minimize:before {
  content: "\F2D1";
}
.fa-window-restore:before {
  content: "\F2D2";
}
.fa-times-rectangle:before,
.fa-window-close:before {
  content: "\F2D3";
}
.fa-times-rectangle-o:before,
.fa-window-close-o:before {
  content: "\F2D4";
}
.fa-bandcamp:before {
  content: "\F2D5";
}
.fa-grav:before {
  content: "\F2D6";
}
.fa-etsy:before {
  content: "\F2D7";
}
.fa-imdb:before {
  content: "\F2D8";
}
.fa-ravelry:before {
  content: "\F2D9";
}
.fa-eercast:before {
  content: "\F2DA";
}
.fa-microchip:before {
  content: "\F2DB";
}
.fa-snowflake-o:before {
  content: "\F2DC";
}
.fa-superpowers:before {
  content: "\F2DD";
}
.fa-wpexplorer:before {
  content: "\F2DE";
}
.fa-meetup:before {
  content: "\F2E0";
}
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
.sr-only-focusable:active,
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  clip: auto;
}
</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) 2014-2016, PhosphorJS Contributors
|
| Distributed under the terms of the BSD 3-Clause License.
|
| The full license is in the file LICENSE, distributed with this software.
|----------------------------------------------------------------------------*/


/*-----------------------------------------------------------------------------
| dom/cursor
|----------------------------------------------------------------------------*/
body.p-mod-override-cursor * {
  cursor: inherit !important;
}


/*-----------------------------------------------------------------------------
| ui/widget
|----------------------------------------------------------------------------*/
.p-Widget {
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  cursor: default;
}


.p-Widget.p-mod-hidden {
  display: none;
}


/*-----------------------------------------------------------------------------
| ui/commandpalette
|----------------------------------------------------------------------------*/
.p-CommandPalette {
  display: flex;
  flex-direction: column;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-CommandPalette-search {
  flex: 0 0 auto;
}


.p-CommandPalette-content {
  flex: 1 1 auto;
  margin: 0;
  padding: 0;
  min-height: 0;
  overflow: auto;
  list-style-type: none;
}


.p-CommandPalette-header {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  text-transform: capitalize;
}


.p-CommandPalette-itemShortcut {
  float: right;
}


.p-CommandPalette-itemLabel {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}


/*-----------------------------------------------------------------------------
| ui/menu
|----------------------------------------------------------------------------*/
.p-Menu {
  position: absolute;
  white-space: nowrap;
  overflow-x: hidden;
  overflow-y: auto;
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-Menu-content {
  margin: 0;
  padding: 0;
  display: table;
  list-style-type: none;
}


.p-Menu-item {
  display: table-row;
}


.p-Menu-item.p-mod-hidden {
  display: none;
}


.p-Menu-itemIcon,
.p-Menu-itemSubmenuIcon {
  display: table-cell;
  text-align: center;
}


.p-Menu-itemLabel {
  display: table-cell;
  text-align: left;
}


.p-Menu-itemShortcut {
  display: table-cell;
  text-align: right;
}


/*-----------------------------------------------------------------------------
| ui/menubar
|----------------------------------------------------------------------------*/
.p-MenuBar {
  outline: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-MenuBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: row;
  list-style-type: none;
}


.p-MenuBar-item {
  box-sizing: border-box;
}


.p-MenuBar-itemIcon,
.p-MenuBar-itemLabel {
  display: inline-block;
}


/*-----------------------------------------------------------------------------
| ui/splitpanel
|----------------------------------------------------------------------------*/
.p-SplitPanel-child {
  z-index: 0;
}


.p-SplitPanel-handle {
  z-index: 1;
}


.p-SplitPanel-handle.p-mod-hidden {
  display: none;
}


.p-SplitPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}


.p-SplitPanel.p-mod-horizontal > .p-SplitPanel-handle {
  cursor: ew-resize;
}


.p-SplitPanel.p-mod-vertical > .p-SplitPanel-handle {
  cursor: ns-resize;
}


.p-SplitPanel.p-mod-horizontal > .p-SplitPanel-handle:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}


.p-SplitPanel.p-mod-vertical > .p-SplitPanel-handle:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}


/*-----------------------------------------------------------------------------
| ui/tabbar
|----------------------------------------------------------------------------*/
.p-TabBar {
  display: flex;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}


.p-TabBar.p-mod-horizontal {
  flex-direction: row;
}


.p-TabBar.p-mod-vertical {
  flex-direction: column;
}


.p-TabBar-content {
  margin: 0;
  padding: 0;
  display: flex;
  flex: 1 1 auto;
  list-style-type: none;
}


.p-TabBar.p-mod-horizontal > .p-TabBar-content {
  flex-direction: row;
}


.p-TabBar.p-mod-vertical > .p-TabBar-content {
  flex-direction: column;
}


.p-TabBar-tab {
  display: flex;
  flex-direction: row;
  box-sizing: border-box;
  overflow: hidden;
}


.p-TabBar-tabIcon,
.p-TabBar-tabCloseIcon {
  flex: 0 0 auto;
}


.p-TabBar-tabLabel {
  flex: 1 1 auto;
  overflow: hidden;
  white-space: nowrap;
}


.p-TabBar-tab.p-mod-hidden {
  display: none;
}


.p-TabBar.p-mod-dragging .p-TabBar-tab {
  position: relative;
}


.p-TabBar.p-mod-horizontal.p-mod-dragging .p-TabBar-tab {
  left: 0;
  transition: left 150ms ease;
}


.p-TabBar.p-mod-vertical.p-mod-dragging .p-TabBar-tab {
  top: 0;
  transition: top 150ms ease;
}


.p-TabBar.p-mod-dragging .p-TabBar-tab.p-mod-dragging {
  transition: none;
}


/*-----------------------------------------------------------------------------
| ui/tabpanel
|----------------------------------------------------------------------------*/
.p-TabPanel-tabBar {
  z-index: 1;
}


.p-TabPanel-stackedPanel {
  z-index: 0;
}


/*-----------------------------------------------------------------------------
| ui/dockpanel
|----------------------------------------------------------------------------*/
.p-DockPanel {
  z-index: 0;
}


.p-DockPanel-widget {
  z-index: 0;
}


.p-DockPanel-tabBar {
  z-index: 1;
}


.p-DockPanel-handle {
  z-index: 2;
}


.p-DockPanel-handle.p-mod-hidden {
  display: none;
}


.p-DockPanel-handle:after {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  content: '';
}


.p-DockPanel-handle.p-mod-horizontal {
  cursor: ew-resize;
}


.p-DockPanel-handle.p-mod-vertical {
  cursor: ns-resize;
}


.p-DockPanel-handle.p-mod-horizontal:after {
  left: 50%;
  min-width: 8px;
  transform: translateX(-50%);
}


.p-DockPanel-handle.p-mod-vertical:after {
  top: 50%;
  min-height: 8px;
  transform: translateY(-50%);
}


.p-DockPanel-overlay {
  z-index: 3;
  box-sizing: border-box;
  pointer-events: none;
}


.p-DockPanel-overlay.p-mod-hidden {
  display: none;
}
</style><style type="text/css">/**
 * The material design colors are adapted from google-material-color v1.2.6
 * https://github.com/danlevan/google-material-color
 * https://github.com/danlevan/google-material-color/blob/f67ca5f4028b2f1b34862f64b0ca67323f91b088/dist/palette.var.css
 *
 * The license for the material design color CSS variables is as follows (see
 * https://github.com/danlevan/google-material-color/blob/f67ca5f4028b2f1b34862f64b0ca67323f91b088/LICENSE)
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2014 Dan Le Van
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
:root {
  --md-red-50: #FFEBEE;
  --md-red-100: #FFCDD2;
  --md-red-200: #EF9A9A;
  --md-red-300: #E57373;
  --md-red-400: #EF5350;
  --md-red-500: #F44336;
  --md-red-600: #E53935;
  --md-red-700: #D32F2F;
  --md-red-800: #C62828;
  --md-red-900: #B71C1C;
  --md-red-A100: #FF8A80;
  --md-red-A200: #FF5252;
  --md-red-A400: #FF1744;
  --md-red-A700: #D50000;

  --md-pink-50: #FCE4EC;
  --md-pink-100: #F8BBD0;
  --md-pink-200: #F48FB1;
  --md-pink-300: #F06292;
  --md-pink-400: #EC407A;
  --md-pink-500: #E91E63;
  --md-pink-600: #D81B60;
  --md-pink-700: #C2185B;
  --md-pink-800: #AD1457;
  --md-pink-900: #880E4F;
  --md-pink-A100: #FF80AB;
  --md-pink-A200: #FF4081;
  --md-pink-A400: #F50057;
  --md-pink-A700: #C51162;

  --md-purple-50: #F3E5F5;
  --md-purple-100: #E1BEE7;
  --md-purple-200: #CE93D8;
  --md-purple-300: #BA68C8;
  --md-purple-400: #AB47BC;
  --md-purple-500: #9C27B0;
  --md-purple-600: #8E24AA;
  --md-purple-700: #7B1FA2;
  --md-purple-800: #6A1B9A;
  --md-purple-900: #4A148C;
  --md-purple-A100: #EA80FC;
  --md-purple-A200: #E040FB;
  --md-purple-A400: #D500F9;
  --md-purple-A700: #AA00FF;

  --md-deep-purple-50: #EDE7F6;
  --md-deep-purple-100: #D1C4E9;
  --md-deep-purple-200: #B39DDB;
  --md-deep-purple-300: #9575CD;
  --md-deep-purple-400: #7E57C2;
  --md-deep-purple-500: #673AB7;
  --md-deep-purple-600: #5E35B1;
  --md-deep-purple-700: #512DA8;
  --md-deep-purple-800: #4527A0;
  --md-deep-purple-900: #311B92;
  --md-deep-purple-A100: #B388FF;
  --md-deep-purple-A200: #7C4DFF;
  --md-deep-purple-A400: #651FFF;
  --md-deep-purple-A700: #6200EA;

  --md-indigo-50: #E8EAF6;
  --md-indigo-100: #C5CAE9;
  --md-indigo-200: #9FA8DA;
  --md-indigo-300: #7986CB;
  --md-indigo-400: #5C6BC0;
  --md-indigo-500: #3F51B5;
  --md-indigo-600: #3949AB;
  --md-indigo-700: #303F9F;
  --md-indigo-800: #283593;
  --md-indigo-900: #1A237E;
  --md-indigo-A100: #8C9EFF;
  --md-indigo-A200: #536DFE;
  --md-indigo-A400: #3D5AFE;
  --md-indigo-A700: #304FFE;

  --md-blue-50: #E3F2FD;
  --md-blue-100: #BBDEFB;
  --md-blue-200: #90CAF9;
  --md-blue-300: #64B5F6;
  --md-blue-400: #42A5F5;
  --md-blue-500: #2196F3;
  --md-blue-600: #1E88E5;
  --md-blue-700: #1976D2;
  --md-blue-800: #1565C0;
  --md-blue-900: #0D47A1;
  --md-blue-A100: #82B1FF;
  --md-blue-A200: #448AFF;
  --md-blue-A400: #2979FF;
  --md-blue-A700: #2962FF;

  --md-light-blue-50: #E1F5FE;
  --md-light-blue-100: #B3E5FC;
  --md-light-blue-200: #81D4FA;
  --md-light-blue-300: #4FC3F7;
  --md-light-blue-400: #29B6F6;
  --md-light-blue-500: #03A9F4;
  --md-light-blue-600: #039BE5;
  --md-light-blue-700: #0288D1;
  --md-light-blue-800: #0277BD;
  --md-light-blue-900: #01579B;
  --md-light-blue-A100: #80D8FF;
  --md-light-blue-A200: #40C4FF;
  --md-light-blue-A400: #00B0FF;
  --md-light-blue-A700: #0091EA;

  --md-cyan-50: #E0F7FA;
  --md-cyan-100: #B2EBF2;
  --md-cyan-200: #80DEEA;
  --md-cyan-300: #4DD0E1;
  --md-cyan-400: #26C6DA;
  --md-cyan-500: #00BCD4;
  --md-cyan-600: #00ACC1;
  --md-cyan-700: #0097A7;
  --md-cyan-800: #00838F;
  --md-cyan-900: #006064;
  --md-cyan-A100: #84FFFF;
  --md-cyan-A200: #18FFFF;
  --md-cyan-A400: #00E5FF;
  --md-cyan-A700: #00B8D4;

  --md-teal-50: #E0F2F1;
  --md-teal-100: #B2DFDB;
  --md-teal-200: #80CBC4;
  --md-teal-300: #4DB6AC;
  --md-teal-400: #26A69A;
  --md-teal-500: #009688;
  --md-teal-600: #00897B;
  --md-teal-700: #00796B;
  --md-teal-800: #00695C;
  --md-teal-900: #004D40;
  --md-teal-A100: #A7FFEB;
  --md-teal-A200: #64FFDA;
  --md-teal-A400: #1DE9B6;
  --md-teal-A700: #00BFA5;

  --md-green-50: #E8F5E9;
  --md-green-100: #C8E6C9;
  --md-green-200: #A5D6A7;
  --md-green-300: #81C784;
  --md-green-400: #66BB6A;
  --md-green-500: #4CAF50;
  --md-green-600: #43A047;
  --md-green-700: #388E3C;
  --md-green-800: #2E7D32;
  --md-green-900: #1B5E20;
  --md-green-A100: #B9F6CA;
  --md-green-A200: #69F0AE;
  --md-green-A400: #00E676;
  --md-green-A700: #00C853;

  --md-light-green-50: #F1F8E9;
  --md-light-green-100: #DCEDC8;
  --md-light-green-200: #C5E1A5;
  --md-light-green-300: #AED581;
  --md-light-green-400: #9CCC65;
  --md-light-green-500: #8BC34A;
  --md-light-green-600: #7CB342;
  --md-light-green-700: #689F38;
  --md-light-green-800: #558B2F;
  --md-light-green-900: #33691E;
  --md-light-green-A100: #CCFF90;
  --md-light-green-A200: #B2FF59;
  --md-light-green-A400: #76FF03;
  --md-light-green-A700: #64DD17;

  --md-lime-50: #F9FBE7;
  --md-lime-100: #F0F4C3;
  --md-lime-200: #E6EE9C;
  --md-lime-300: #DCE775;
  --md-lime-400: #D4E157;
  --md-lime-500: #CDDC39;
  --md-lime-600: #C0CA33;
  --md-lime-700: #AFB42B;
  --md-lime-800: #9E9D24;
  --md-lime-900: #827717;
  --md-lime-A100: #F4FF81;
  --md-lime-A200: #EEFF41;
  --md-lime-A400: #C6FF00;
  --md-lime-A700: #AEEA00;

  --md-yellow-50: #FFFDE7;
  --md-yellow-100: #FFF9C4;
  --md-yellow-200: #FFF59D;
  --md-yellow-300: #FFF176;
  --md-yellow-400: #FFEE58;
  --md-yellow-500: #FFEB3B;
  --md-yellow-600: #FDD835;
  --md-yellow-700: #FBC02D;
  --md-yellow-800: #F9A825;
  --md-yellow-900: #F57F17;
  --md-yellow-A100: #FFFF8D;
  --md-yellow-A200: #FFFF00;
  --md-yellow-A400: #FFEA00;
  --md-yellow-A700: #FFD600;

  --md-amber-50: #FFF8E1;
  --md-amber-100: #FFECB3;
  --md-amber-200: #FFE082;
  --md-amber-300: #FFD54F;
  --md-amber-400: #FFCA28;
  --md-amber-500: #FFC107;
  --md-amber-600: #FFB300;
  --md-amber-700: #FFA000;
  --md-amber-800: #FF8F00;
  --md-amber-900: #FF6F00;
  --md-amber-A100: #FFE57F;
  --md-amber-A200: #FFD740;
  --md-amber-A400: #FFC400;
  --md-amber-A700: #FFAB00;

  --md-orange-50: #FFF3E0;
  --md-orange-100: #FFE0B2;
  --md-orange-200: #FFCC80;
  --md-orange-300: #FFB74D;
  --md-orange-400: #FFA726;
  --md-orange-500: #FF9800;
  --md-orange-600: #FB8C00;
  --md-orange-700: #F57C00;
  --md-orange-800: #EF6C00;
  --md-orange-900: #E65100;
  --md-orange-A100: #FFD180;
  --md-orange-A200: #FFAB40;
  --md-orange-A400: #FF9100;
  --md-orange-A700: #FF6D00;

  --md-deep-orange-50: #FBE9E7;
  --md-deep-orange-100: #FFCCBC;
  --md-deep-orange-200: #FFAB91;
  --md-deep-orange-300: #FF8A65;
  --md-deep-orange-400: #FF7043;
  --md-deep-orange-500: #FF5722;
  --md-deep-orange-600: #F4511E;
  --md-deep-orange-700: #E64A19;
  --md-deep-orange-800: #D84315;
  --md-deep-orange-900: #BF360C;
  --md-deep-orange-A100: #FF9E80;
  --md-deep-orange-A200: #FF6E40;
  --md-deep-orange-A400: #FF3D00;
  --md-deep-orange-A700: #DD2C00;

  --md-brown-50: #EFEBE9;
  --md-brown-100: #D7CCC8;
  --md-brown-200: #BCAAA4;
  --md-brown-300: #A1887F;
  --md-brown-400: #8D6E63;
  --md-brown-500: #795548;
  --md-brown-600: #6D4C41;
  --md-brown-700: #5D4037;
  --md-brown-800: #4E342E;
  --md-brown-900: #3E2723;

  --md-grey-50: #FAFAFA;
  --md-grey-100: #F5F5F5;
  --md-grey-200: #EEEEEE;
  --md-grey-300: #E0E0E0;
  --md-grey-400: #BDBDBD;
  --md-grey-500: #9E9E9E;
  --md-grey-600: #757575;
  --md-grey-700: #616161;
  --md-grey-800: #424242;
  --md-grey-900: #212121;

  --md-blue-grey-50: #ECEFF1;
  --md-blue-grey-100: #CFD8DC;
  --md-blue-grey-200: #B0BEC5;
  --md-blue-grey-300: #90A4AE;
  --md-blue-grey-400: #78909C;
  --md-blue-grey-500: #607D8B;
  --md-blue-grey-600: #546E7A;
  --md-blue-grey-700: #455A64;
  --md-blue-grey-800: #37474F;
  --md-blue-grey-900: #263238;
}</style><style type="text/css">/*-----------------------------------------------------------------------------
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/

/*
The following CSS variables define the main, public API for styling JupyterLab.
These variables should be used by all plugins wherever possible. In other
words, plugins should not define custom colors, sizes, etc unless absolutely
necessary. This enables users to change the visual theme of JupyterLab
by changing these variables.

Many variables appear in an ordered sequence (0,1,2,3). These sequences
are designed to work well together, so for example, `--jp-border-color1` should
be used with `--jp-layout-color1`. The numbers have the following meanings:

* 0: super-primary, reserved for special emphasis
* 1: primary, most important under normal situations
* 2: secondary, next most important under normal situations
* 3: tertiary, next most important under normal situations

Throughout JupyterLab, we are mostly following principles from Google's
Material Design when selecting colors. We are not, however, following 
all of MD as it is not optimized for dense, information rich UIs.
*/


:root {

  /* Borders
  
  The following variables, specify the visual styling of borders in JupyterLab.
   */

  --jp-border-width: 1px;
  --jp-border-color0: var(--md-grey-700);  
  --jp-border-color1: var(--md-grey-500);
  --jp-border-color2: var(--md-grey-300);
  --jp-border-color3: var(--md-grey-100);

  /* UI Fonts
  
  The UI font CSS variables are used for the typography all of the JupyterLab
  user interface elements that are not directly user generated content.
  */

  --jp-ui-font-scale-factor: 1.2;
  --jp-ui-font-size0: calc(var(--jp-ui-font-size1)/var(--jp-ui-font-scale-factor));
  --jp-ui-font-size1: 13px; /* Base font size */
  --jp-ui-font-size2: calc(var(--jp-ui-font-size1)*var(--jp-ui-font-scale-factor));
  --jp-ui-font-size3: calc(var(--jp-ui-font-size2)*var(--jp-ui-font-scale-factor));
  --jp-ui-icon-font-size: 14px; /* Ensures px perfect FontAwesome icons */

  /* Use these font colors against the corresponding main layout colors.
     In a light theme, these go from dark to light.
  */

  --jp-ui-font-color0: rgba(0,0,0,1.0);
  --jp-ui-font-color1: rgba(0,0,0,0.87);
  --jp-ui-font-color2: rgba(0,0,0,0.54);
  --jp-ui-font-color3: rgba(0,0,0,0.38);
  
  /* Use these against the brand/accent/warn/error colors.
     These will typically go from light to darker, in both a dark and light theme
   */

  --jp-inverse-ui-font-color0: rgba(255,255,255,1);
  --jp-inverse-ui-font-color1: rgba(255,255,255,1.0);
  --jp-inverse-ui-font-color2: rgba(255,255,255,0.7);
  --jp-inverse-ui-font-color3: rgba(255,255,255,0.5);

  /* Content Fonts
  
  Content font variables are used for typography of user generated content.
  */
  
  --jp-content-font-size: 13px;
  --jp-content-line-height: 1.5;
  --jp-content-font-color0: black;
  --jp-content-font-color1: black;
  --jp-content-font-color2: var(--md-grey-700);
  --jp-content-font-color3: var(--md-grey-500);

  --jp-ui-font-scale-factor: 1.2;
  --jp-ui-font-size0: calc(var(--jp-ui-font-size1)/var(--jp-ui-font-scale-factor));
  --jp-ui-font-size1: 13px; /* Base font size */
  --jp-ui-font-size2: calc(var(--jp-ui-font-size1)*var(--jp-ui-font-scale-factor));
  --jp-ui-font-size3: calc(var(--jp-ui-font-size2)*var(--jp-ui-font-scale-factor));

  --jp-code-font-size: 13px;
  --jp-code-line-height: 17px;
  --jp-code-padding: 5px;

  /* Layout
  
  The following are the main layout colors use in JupyterLab. In a light
  theme these would go from light to dark.
  */

  --jp-layout-color0: white;  
  --jp-layout-color1: white;
  --jp-layout-color2: var(--md-grey-200);
  --jp-layout-color3: var(--md-grey-400);

  /* Brand/accent */

  --jp-brand-color0: var(--md-blue-700);
  --jp-brand-color1: var(--md-blue-500);
  --jp-brand-color2: var(--md-blue-300);
  --jp-brand-color3: var(--md-blue-100);

  --jp-accent-color0: var(--md-green-700);
  --jp-accent-color1: var(--md-green-500);
  --jp-accent-color2: var(--md-green-300);
  --jp-accent-color3: var(--md-green-100);

  /* State colors (warn, error, success, info) */

  --jp-warn-color0: var(--md-orange-700);
  --jp-warn-color1: var(--md-orange-500);
  --jp-warn-color2: var(--md-orange-300);
  --jp-warn-color3: var(--md-orange-100);

  --jp-error-color0: var(--md-red-700);
  --jp-error-color1: var(--md-red-500);
  --jp-error-color2: var(--md-red-300);
  --jp-error-color3: var(--md-red-100);

  --jp-success-color0: var(--md-green-700);
  --jp-success-color1: var(--md-green-500);
  --jp-success-color2: var(--md-green-300);
  --jp-success-color3: var(--md-green-100);

  --jp-info-color0: var(--md-cyan-700);
  --jp-info-color1: var(--md-cyan-500);
  --jp-info-color2: var(--md-cyan-300);
  --jp-info-color3: var(--md-cyan-100);

}
</style><style type="text/css">/* Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/*
 * We assume that the CSS variables in
 * https://github.com/jupyterlab/jupyterlab/blob/master/src/default-theme/variables.css
 * have been defined.
 */


:root {
    --jp-widgets-color: var(--jp-content-font-color1);
    --jp-widgets-label-color: var(--jp-widgets-color);
    --jp-widgets-readout-color: var(--jp-widgets-color);
    --jp-widgets-font-size: var(--jp-ui-font-size1);
    --jp-widgets-margin: 2px;
    --jp-widgets-inline-height: 28px;
    --jp-widgets-inline-width: 300px;
    --jp-widgets-inline-width-short: calc(var(--jp-widgets-inline-width) / 2 - var(--jp-widgets-margin));
    --jp-widgets-inline-width-tiny: calc(var(--jp-widgets-inline-width-short) / 2 - var(--jp-widgets-margin));
    --jp-widgets-inline-margin: 4px; /* margin between inline elements */
    --jp-widgets-inline-label-min-width: 80px;
    --jp-widgets-inline-label-max-width: calc(var(--jp-widgets-inline-width) - var(--jp-widgets-inline-margin) - var(--jp-widgets-inline-width-short));
    --jp-widgets-border-width: var(--jp-border-width);
    --jp-widgets-vertical-height: 200px;
    --jp-widgets-horizontal-tab-height: 24px;
    --jp-widgets-horizontal-tab-width: 144px;
    --jp-widgets-horizontal-tab-top-border: 2px;
    --jp-widgets-progress-thickness: 20px;
    --jp-widgets-container-padding: 15px;
    --jp-widgets-input-padding: 4px;
    --jp-widgets-slider-track-thickness: 4px;
    --jp-widgets-slider-handle-size: 16px;
    --jp-widgets-slider-border-width: var(--jp-widgets-border-width);
    --jp-widgets-slider-active-handle-color: var(--jp-brand-color1);
    --jp-widgets-menu-item-height: 24px;

    --jp-widgets-input-color: var(--jp-ui-font-color1);
    --jp-widgets-input-background-color: var(--jp-layout-color1);
    --jp-widgets-input-border-color: var(--jp-border-color1);
    --jp-widgets-input-focus-border-color: var(--jp-brand-color2);
    --jp-widgets-input-border-width: var(--jp-widgets-border-width);

    /* From Material Design Lite */
    --md-shadow-key-umbra-opacity: 0.2;
    --md-shadow-key-penumbra-opacity: 0.14;
    --md-shadow-ambient-shadow-opacity: 0.12;
}

.jupyter-widgets {
    margin: var(--jp-widgets-margin);
    box-sizing: border-box;
    color: var(--jp-widgets-color);
    overflow: visible;
}

.jp-Output-result > .jupyter-widgets {
    margin-left: 0;
    margin-right: 0;
}

/* vbox and hbox */

.widget-inline-hbox {
    /* Horizontal widgets */
    box-sizing: border-box;
    display: flex;
    flex-direction: row;
    align-items: baseline;
}

.widget-inline-vbox {
    /* Vertical Widgets */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.widget-box {
    box-sizing: border-box;
    display: flex;
    margin: 0;
}

.widget-hbox {
    flex-direction: row;
}

.widget-vbox {
    flex-direction: column;
}

/* General Button Styling */

.jupyter-button {
    padding: 0;
    display: inline-block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
    font-size: var(--jp-widgets-font-size);
    cursor: pointer;

    height: var(--jp-widgets-inline-height);
    border: 0px solid;
    line-height: var(--jp-widgets-inline-height);
    box-shadow: none;

    color: var(--jp-ui-font-color1);
    background-color: var(--jp-layout-color2);
    border-color: var(--jp-border-color2);
    border: none;
    text-transform: uppercase;
    letter-spacing: 0.8px;
}

.jupyter-button i.fa {
    margin-right: var(--jp-widgets-inline-margin);
    pointer-events: none;
}

.jupyter-button:empty:before {
    content: "\200B"; /* zero-width space */
}

.jupyter-button:hover, .jupyter-button:focus {
    /* MD Lite 2dp shadow */
    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, var(--md-shadow-key-penumbra-opacity)),
                0 3px 1px -2px rgba(0, 0, 0, var(--md-shadow-key-umbra-opacity)),
                0 1px 5px 0 rgba(0, 0, 0, var(--md-shadow-ambient-shadow-opacity));
}

.jupyter-button:active, .jupyter-button.mod-active {
    /* MD Lite 4dp shadow */
    box-shadow: 0 4px 5px 0 rgba(0, 0, 0, var(--md-shadow-key-penumbra-opacity)),
                0 1px 10px 0 rgba(0, 0, 0, var(--md-shadow-ambient-shadow-opacity)),
                0 2px 4px -1px rgba(0, 0, 0, var(--md-shadow-key-umbra-opacity));
    color: var(--jp-ui-font-color1);
    background-color: var(--jp-layout-color3);
}

.jupyter-button:focus {
    outline: 1px solid var(--jp-widgets-input-focus-border-color);
}

/* Button "Primary" Styling */

.jupyter-button.mod-primary {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-brand-color1);
}

.jupyter-button.mod-primary.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-brand-color0);
}

.jupyter-button.mod-primary:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-brand-color0);
}

/* Button "Success" Styling */

.jupyter-button.mod-success {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-success-color1);
}

.jupyter-button.mod-success.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-success-color0);
 }

.jupyter-button.mod-success:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-success-color0);
 }

 /* Button "Info" Styling */

.jupyter-button.mod-info {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-info-color1);
}

.jupyter-button.mod-info.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-info-color0);
}

.jupyter-button.mod-info:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-info-color0);
}

/* Button "Warning" Styling */

.jupyter-button.mod-warning {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-warn-color1);
}

.jupyter-button.mod-warning.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-warn-color0);
}

.jupyter-button.mod-warning:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-warn-color0);
}

/* Button "Danger" Styling */

.jupyter-button.mod-danger {
    color: var(--jp-inverse-ui-font-color1);
    background-color: var(--jp-error-color1);
}

.jupyter-button.mod-danger.mod-active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-error-color0);
}

.jupyter-button.mod-danger:active {
    color: var(--jp-inverse-ui-font-color0);
    background-color: var(--jp-error-color0);
}

/* Widget Button*/

.widget-button, .widget-toggle-button {
    width: var(--jp-widgets-inline-width-short);
}

/* Widget Label Styling */

.widget-label {
    /* Label */
    color: var(--jp-widgets-label-color);
    font-size: var(--jp-widgets-font-size);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: var(--jp-widgets-inline-height);
    max-width: var(--jp-widgets-inline-width);
}

.jupyter-widgets.widget-label {
    width: var(--jp-widgets-inline-width-tiny);
}

.widget-inline-hbox .widget-label {
    /* Horizontal Widget Label */
    color: var(--jp-widgets-label-color);
    text-align: right;
    margin-right: var(--jp-widgets-inline-margin);
    max-width: var(--jp-widgets-inline-label-max-width);
    min-width: var(--jp-widgets-inline-label-min-width);
    flex-shrink: 0;
}

.widget-inline-vbox .widget-label {
    /* Vertical Widget Label */
    color: var(--jp-widgets-label-color);
    text-align: center;
}

/* Widget Readout Styling */

.widget-readout {
    color: var(--jp-widgets-readout-color);
    font-size: var(--jp-widgets-font-size);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    margin-left: var(--jp-widgets-inline-margin);
    overflow: hidden;
    white-space: nowrap;
    text-align: center;
}

.widget-readout.overflow {
    /* Overflowing Readout */

    /* From Material Design Lite
        shadow-key-umbra-opacity: 0.2;
        shadow-key-penumbra-opacity: 0.14;
        shadow-ambient-shadow-opacity: 0.12;
     */
    -webkit-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.2),
                        0 3px 1px -2px rgba(0, 0, 0, 0.14),
                        0 1px 5px 0 rgba(0, 0, 0, 0.12);

    -moz-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.2),
                     0 3px 1px -2px rgba(0, 0, 0, 0.14),
                     0 1px 5px 0 rgba(0, 0, 0, 0.12);

    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.2),
                0 3px 1px -2px rgba(0, 0, 0, 0.14),
                0 1px 5px 0 rgba(0, 0, 0, 0.12);
}

.widget-inline-hbox .widget-readout {
    /* Horizontal Readout */
    text-align: center;
    max-width: var(--jp-widgets-inline-width-short);
    min-width: var(--jp-widgets-inline-width-tiny);
    margin-left: var(--jp-widgets-inline-margin);
}

.widget-inline-vbox .widget-readout {
    /* Vertical Readout */
    margin-top: var(--jp-widgets-inline-margin);
}

/* Widget Checkbox Styling */

.widget-checkbox {
    width: var(--jp-widgets-inline-width-short);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    justify-content: space-between;
}

.widget-checkbox input[type="checkbox"] {
    margin: 0px var(--jp-widgets-inline-margin) 0px var(--jp-widgets-inline-margin);
    line-height: var(--jp-widgets-inline-height);
    font-size: large;
    flex-grow: 1;
    flex-shrink: 0;
    align-self: center;
}

/* Widget Valid Styling */

.widget-valid {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    width: var(--jp-widgets-inline-width-short);
    font-size: var(--jp-widgets-font-size);
}

.widget-valid i:before {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    margin-right: var(--jp-widgets-inline-margin);
    margin-left: var(--jp-widgets-inline-margin);

    /* from the fa class in FontAwesome: https://github.com/FortAwesome/Font-Awesome/blob/49100c7c3a7b58d50baa71efef11af41a66b03d3/css/font-awesome.css#L14 */
    display: inline-block;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.widget-valid.mod-valid i:before {
    content: "\F00C";
    color: green;
}

.widget-valid.mod-invalid i:before {
    content: "\F00D";
    color: red;
}

.widget-valid.mod-valid .widget-valid-readout {
    display: none;
}

/* Widget Text and TextArea Stying */

.widget-textarea, .widget-text {
    width: var(--jp-widgets-inline-width);
}

.widget-text input[type="text"] {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-text input[type="text"], .widget-textarea textarea {
    box-sizing: border-box;
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) *  2 );
    flex-grow: 1;
    min-width: 0; /* This makes it possible for the flexbox to shrink this input */
    flex-shrink: 1;
    outline: none !important;
    line-height: 1.5;
}

.widget-textarea textarea {
    height: inherit;
    width: inherit;
}

.widget-text input:focus, .widget-textarea textarea:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

/* Widget Slider */

.widget-slider .ui-slider {
    /* Slider Track */
    border: var(--jp-widgets-slider-border-width) solid var(--jp-layout-color3);
    background: var(--jp-layout-color3);
    box-sizing: border-box;
    position: relative;
    border-radius: 0px;
}

.widget-slider .ui-slider-handle {
    /* Slider Handle */
    outline: none !important; /* focused slider handles are colored - see below */
    position: absolute;
    background-color: var(--jp-layout-color1);
    border: var(--jp-widgets-slider-border-width) solid var(--jp-border-color1);
    box-sizing: border-box;
    z-index: 1;
    background-image: none; /* Override jquery-ui */
}

/* Override jquery-ui */
.widget-slider .ui-slider-handle:hover, .widget-slider .ui-slider-handle:focus {
    background-color: var(--jp-widgets-slider-active-handle-color);
    border: var(--jp-widgets-slider-border-width) solid var(--jp-widgets-slider-active-handle-color);
}

.widget-slider .ui-slider-handle:active {
    background-color: var(--jp-widgets-slider-active-handle-color);
    border-color: var(--jp-widgets-slider-active-handle-color);
    z-index: 2;
    transform: scale(1.2);
}

.widget-slider .ui-slider-range {
    /* Interval between the two specified value of a double slider */
    position: absolute;
    background: var(--jp-widgets-slider-active-handle-color);
    z-index: 0;
}

/* Shapes of Slider Handles */

.widget-hslider .ui-slider-handle {
    width: var(--jp-widgets-slider-handle-size);
    height: var(--jp-widgets-slider-handle-size);
    margin-top: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-handle-size)) / 2 - var(--jp-widgets-slider-border-width));
    margin-left: calc(var(--jp-widgets-slider-handle-size) / -2 + var(--jp-widgets-slider-border-width));
    border-radius: 50%;
    top: 0;
}

.widget-vslider .ui-slider-handle {
    width: var(--jp-widgets-slider-handle-size);
    height: var(--jp-widgets-slider-handle-size);
    margin-bottom: calc(var(--jp-widgets-slider-handle-size) / -2 + var(--jp-widgets-slider-border-width));
    margin-left: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-handle-size)) / 2 - var(--jp-widgets-slider-border-width));
    border-radius: 50%;
    left: 0;
}

.widget-hslider .ui-slider-range {
    height: calc( var(--jp-widgets-slider-track-thickness) * 2 );
    margin-top: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-track-thickness) * 2 ) / 2 - var(--jp-widgets-slider-border-width));
}

.widget-vslider .ui-slider-range {
    width: calc( var(--jp-widgets-slider-track-thickness) * 2 );
    margin-left: calc((var(--jp-widgets-slider-track-thickness) - var(--jp-widgets-slider-track-thickness) * 2 ) / 2 - var(--jp-widgets-slider-border-width));
}

/* Horizontal Slider */

.widget-hslider {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widgets-slider .slider-container {
    overflow: visible;
}

.widget-hslider .slider-container {
    height: var(--jp-widgets-inline-height);
    margin-left: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    margin-right: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    align-self: stretch;
    flex: 1 1 var(--jp-widgets-inline-width-short);
}

.widget-hslider .ui-slider {
    /* Inner, invisible slide div */
    height: var(--jp-widgets-slider-track-thickness);
    margin-top: calc((var(--jp-widgets-inline-height) - var(--jp-widgets-slider-track-thickness)) / 2);
    width: 100%;
}

/* Vertical Slider */

.widget-vbox .widget-label {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-vslider {
    /* Vertical Slider */
    height: var(--jp-widgets-vertical-height);
    width: var(--jp-widgets-inline-width-tiny);
}

.widget-vslider .slider-container {
    flex: 1 1 var(--jp-widgets-inline-width-short);
    margin-left: auto;
    margin-right: auto;
    margin-bottom: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
    margin-top: calc(var(--jp-widgets-slider-handle-size) / 2 - 2 * var(--jp-widgets-slider-border-width));
}

.widget-vslider .ui-slider {
    /* Inner, invisible slide div */
    width: var(--jp-widgets-slider-track-thickness);
    height: 100%;
    margin-left: calc((6px - var(--jp-widgets-slider-track-thickness)) / 2);
}

/* Widget Progress Styling */

.progress-bar {
    -webkit-transition: none;
    -moz-transition: none;
    -ms-transition: none;
    -o-transition: none;
    transition: none;
}

.progress-bar {
    height: var(--jp-widgets-inline-height);
}

.progress-bar {
    background-color: var(--jp-brand-color1);
}

.progress-bar-success {
    background-color: var(--jp-success-color1);
}

.progress-bar-info {
    background-color: var(--jp-info-color1);
}

.progress-bar-warning {
    background-color: var(--jp-warn-color1);
}

.progress-bar-danger {
    background-color: var(--jp-error-color1);
}

.progress {
    background-color: var(--jp-layout-color2);
    border: none;
    box-shadow: none;
}

/* Horisontal Progress */

.widget-hprogress {
    /* Progress Bar */
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    width: var(--jp-widgets-inline-width);
}

.widget-hprogress .progress {
    flex-grow: 1;
    height: var(--jp-widgets-progress-thickness);
    margin-top: auto;
    margin-bottom: auto;
}

/* Vertical Progress */

.widget-vprogress {
    height: var(--jp-widgets-vertical-height);
    width: var(--jp-widgets-inline-width-tiny);
}

.widget-vprogress .progress {
    flex-grow: 1;
    width: var(--jp-widgets-progress-thickness);
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 0;
}

/* Select Widget Styling */

.widget-select {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-select select {
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    border-radius: 0;
    height: var(--jp-widgets-inline-height);
    flex: 1 1 var(--jp-widgets-inline-width-short);
    box-sizing: border-box;
    outline: none !important;
    box-shadow: none;
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    vertical-align: top;
    padding-left: calc( var(--jp-widgets-input-padding) * 2);
	appearance: none;
	-webkit-appearance: none;
	-moz-appearance: none;
    background-repeat: no-repeat;
	background-size: 20px;
	background-position: right center;
    background-image: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOCAxOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTggMTg7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDpub25lO30KPC9zdHlsZT4KPHBhdGggZD0iTTUuMiw1LjlMOSw5LjdsMy44LTMuOGwxLjIsMS4ybC00LjksNWwtNC45LTVMNS4yLDUuOXoiLz4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAtMC42aDE4djE4SDBWLTAuNnoiLz4KPC9zdmc+Cg");
}

.widget-select select:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

/* To disable the dotted border in Firefox around select controls.
   See http://stackoverflow.com/a/18853002 */
.widget-select select:-moz-focusring {
    color: transparent;
    text-shadow: 0 0 0 #000;
}

.widget-select select option:checked {
    color: var(--jp-ui-font-color0);
    background: var(--jp-layout-color0) repeat url("data:image/gif;base64,R0lGO...");
}

/* Select Multiple */

.widget-select-multiple {
    width: var(--jp-widgets-inline-width);
    line-height: var(--jp-widgets-inline-height);
}

.widget-select-multiple select {
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    flex: 1 1 var(--jp-widgets-inline-width-short);
    outline: none !important;
    overflow: auto;
}

.widget-select-multiple select:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

.widget-select-multiple select option:checked {
    color: var(--jp-ui-font-color0);
    background: var(--jp-layout-color0) repeat url("data:image/gif;base64,R0lGO...");
}

.wiget-select-multiple select option {
    padding-left: var(--jp-widgets-input-padding);
    line-height: var(--jp-widgets-inline-height);
    /* line-height doesn't work on some browsers for select options */
    padding-top: calc(var(--jp-widgets-inline-height)-var(--jp-widgets-font-size)/2);
    padding-bottom: calc(var(--jp-widgets-inline-height)-var(--jp-widgets-font-size)/2);
}



/* Toggle Buttons Styling */

.widget-toggle-buttons {
    line-height: var(--jp-widgets-inline-height);
}

.widget-toggle-buttons .widget-toggle-button {
    margin-left: var(--jp-widgets-margin);
    margin-right: var(--jp-widgets-margin);
}

/* Radio Buttons Styling */

.widget-radio {
    width: var(--jp-widgets-inline-width);
    line-height: var(--jp-widgets-inline-height);
}

.widget-radio-box {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    box-sizing: border-box;
    flex-grow: 1;
}

.widget-radio-box label {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    font-size: var(--jp-widgets-font-size);
}

.widget-radio-box input {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    margin: 0 var(--jp-widgets-input-padding) 0 var(--jp-widgets-input-padding);
    float: left;
}

/* Color Picker Styling */

.widget-colorpicker {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-colorpicker > .widget-colorpicker-input {
    flex-grow: 1;
    flex-shrink: 1;
    min-width: var(--jp-widgets-inline-width-tiny);
}

.widget-colorpicker input[type="color"] {
    width: var(--jp-widgets-inline-height);
    height: var(--jp-widgets-inline-height);
    padding: 0 2px; /* make the color square actually square on Chrome on OS X */
    background: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    border-left: none;
    flex-grow: 0;
    flex-shrink: 0;
    box-sizing: border-box;
    align-self: stretch;
    outline: none !important;
}

.widget-colorpicker.concise input[type="color"] {
    border-left: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
}

.widget-colorpicker input[type="color"]:focus, .widget-colorpicker input[type="text"]:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

.widget-colorpicker input[type="text"] {
    flex-grow: 1;
    outline: none !important;
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    background: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    font-size: var(--jp-widgets-font-size);
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) *  2 );
    min-width: 0; /* This makes it possible for the flexbox to shrink this input */
    flex-shrink: 1;
    box-sizing: border-box;
}

/* Date Picker Styling */

.widget-datepicker {
    width: var(--jp-widgets-inline-width);
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
}

.widget-datepicker input[type="date"] {
    flex-grow: 1;
    outline: none !important;
    height: var(--jp-widgets-inline-height);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    font-size: var(--jp-widgets-font-size);
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) *  2 );
    box-sizing: border-box;
}

.widget-datepicker input[type="date"]:focus {
    border-color: var(--jp-widgets-input-focus-border-color);
}

/* Play Widget */

.widget-play {
    min-width: var(--jp-widgets-inline-width-short);
    display: flex;
    justify-content: space-between;
}

.widget-play .jupyter-button {
    min-width: calc(var(--jp-widgets-inline-width-short) / 3 - 2 * var(--jp-widgets-margin));
    text-align: center;
}

/* Tab Widget */

.jupyter-widgets .p-TabBar {
    overflow-x: visible;
    overflow-y: visible;
}

.jupyter-widgets.widget-tab .p-TabBar.p-mod-horizontal > .p-TabBar-content {
    align-items: flex-end;
    margin-bottom: 0;
}

.jupyter-widgets.widget-tab .widget-tab-contents {
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    background: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
    border: var(--jp-border-width) solid var(--jp-border-color1);
    padding: var(--jp-widgets-container-padding);
}

.jupyter-widgets.widget-tab .widget-tab-contents .widget-tab-child.p-mod-hidden {
    display: none !important;
}

.jupyter-widgets.widget-tab .widget-tab-bar.p-TabBar {
    font: var(--jp-widgets-font-size) Helvetica, Arial, sans-serif;
}

.jupyter-widgets.widget-tab .p-TabBar-tab {
    flex: 0 1 var(--jp-widgets-horizontal-tab-width);
    min-width: 35px;
    min-height: calc(var(--jp-widgets-horizontal-tab-height) + var(--jp-border-width));
    line-height: var(--jp-widgets-horizontal-tab-height);
    margin-left: calc(-1 * var(--jp-border-width));
    padding: 0px 10px;
    background: var(--jp-layout-color2);
    color: var(--jp-ui-font-color2);
    border: var(--jp-border-width) solid var(--jp-border-color1);
    border-bottom: none;
    position: relative;
}

.jupyter-widgets.widget-tab .p-TabBar-tab.p-mod-current {
    color: var(--jp-ui-font-color0);
    /* We want the background to match the tab content background */
    background: var(--jp-layout-color1);
    min-height: calc(var(--jp-widgets-horizontal-tab-height) + 2 * var(--jp-border-width));
    transform: translateY(var(--jp-border-width));
}

.jupyter-widgets.widget-tab .p-TabBar-tab.p-mod-current:before {
    position: absolute;
    top: calc(-1 * var(--jp-border-width));
    left: calc(-1 * var(--jp-border-width));
    content: '';
    height: var(--jp-widgets-horizontal-tab-top-border);
    width: calc(100% + 2 * var(--jp-border-width));
    background: var(--jp-brand-color1);
}

.jupyter-widgets.widget-tab .p-TabBar-tab:first-child {
    margin-left: 0;
}

.jupyter-widgets.widget-tab .p-TabBar-tab:hover:not(.p-mod-current) {
    background: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
}

.jupyter-widgets.widget-tab.p-mod-closable > .p-TabBar-tabCloseIcon {
    margin-left: 4px;
}

.jupyter-widgets.widget-tab.p-mod-closable > .p-TabBar-tabCloseIcon:before {
    font-family: FontAwesome;
    content: '\F00D'; /* close */
}

.jupyter-widgets.widget-tab .p-TabBar-tabIcon,
.jupyter-widgets.widget-tab .p-TabBar-tabLabel,
.jupyter-widgets.widget-tab .p-TabBar-tabCloseIcon {
    line-height: var(--jp-widgets-horizontal-tab-height);
}

/* Accordion Widget */

.p-Collapse {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.p-Collapse-header {
    padding: var(--jp-widgets-input-padding);
    cursor: pointer;
    color: var(--jp-ui-font-color2);
    background-color: var(--jp-layout-color2);
    border: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    padding: calc(var(--jp-widgets-container-padding) * 2 / 3) var(--jp-widgets-container-padding);
    font-weight: bold;
}

.p-Collapse-header:hover {
    background-color: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
}

.p-Collapse-open .p-Collapse-header {
    background-color: var(--jp-layout-color1);
    color: var(--jp-ui-font-color0);
    cursor: default;
    border-bottom: none;
}

.p-Collapse .p-Collapse-header::before {
    content: '\F0DA\A0';  /* caret-right, non-breaking space */
    display: inline-block;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.p-Collapse-open .p-Collapse-header::before {
    content: '\F0D7\A0'; /* caret-down, non-breaking space */
}

.p-Collapse-contents {
    padding: var(--jp-widgets-container-padding);
    background-color: var(--jp-layout-color1);
    color: var(--jp-ui-font-color1);
    border-left: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    border-right: var(--jp-widgets-border-width) solid var(--jp-border-color1);
    border-bottom: var(--jp-widgets-border-width) solid var(--jp-border-color1);
}

.p-Accordion {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.p-Accordion .p-Collapse {
    margin-bottom: 0;
}

.p-Accordion .p-Collapse + .p-Collapse {
    margin-top: 4px;
}



/* HTML widget */

.widget-html, .widget-htmlmath {
    font-size: var(--jp-widgets-font-size);
}
</style><style type="text/css">/* Copyright (c) Jupyter Development Team.
 * Distributed under the terms of the Modified BSD License.
 */

/* We import all of these together in a single css file because the Webpack
loader sees only one file at a time. This allows postcss to see the variable
definitions when they are used. */
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 0; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

<body class="nbviewer scrolled"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

  <!-- These are loaded at the top of the body so they are available to
       notebook cells when they are loaded below. -->
  <script src="./Jupyter Notebook Viewer_files/jquery.min.js"></script>
  <script src="./Jupyter Notebook Viewer_files/require.js"></script>
  <script src="./Jupyter Notebook Viewer_files/moment.min.js"></script>

<!-- Navbar
================================================== -->
  <nav id="menubar" class="navbar navbar-default navbar-fixed-top animated affix headroom--not-top slideOutUp" data-spy="affix">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <i class="fa fa-bars"></i>
        </button>
        <a class="navbar-brand" href="http://nbviewer.jupyter.org/">
          <img src="./Jupyter Notebook Viewer_files/nav_logo.svg" width="159">
        </a>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a class="active" href="http://jupyter.org/">JUPYTER</a>
          </li>
          <li>
    <a href="http://nbviewer.jupyter.org/faq" title="FAQ">
      
        <span>FAQ</span>
      
    </a>
  </li>

          
  
    
  
    
      
        <li>
    <a href="http://nbviewer.jupyter.org/format/script/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb" title="View as Code">
      <span class="fa fa-code fa-2x menu-icon"></span>
      <span class="menu-text">View as Code</span>
    </a>
  </li>
      
    
  

  
    <li>
    <a href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#" title="Python [default] Kernel">
      <span class="fa fa-server fa-2x menu-icon"></span>
      <span class="menu-text">Python [default] Kernel</span>
    </a>
  </li>
  

  
    <li>
    <a href="https://github.com/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb" title="View on GitHub">
      <span class="fa fa-github fa-2x menu-icon"></span>
      <span class="menu-text">View on GitHub</span>
    </a>
  </li>
  

  <li>
    <a href="https://raw.githubusercontent.com/spro/practical-pytorch/master/seq2seq-translation/seq2seq-translation.ipynb" title="Download Notebook" download="">
      <span class="fa fa-download fa-2x menu-icon"></span>
      <span class="menu-text">Download Notebook</span>
    </a>
  </li>

        </ul>
      </div><!-- /.navbar-collapse -->
      
      
    </div>
  </nav>

  <div class="container container-main">
    
  
  <ol class="breadcrumb">
    
      <li>
        <a href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/tree/master">practical-pytorch</a>
      </li>
    
      <li>
        <a href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/tree/master/seq2seq-translation">seq2seq-translation</a>
      </li>
    
  </ol>
  
  <div id="notebook">
    <div id="notebook-container">
      
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="./Jupyter Notebook Viewer_files/eBRPvWB.png" alt=""></p>
<h1 id="Practical-PyTorch:-Translation-with-a-Sequence-to-Sequence-Network-and-Attention">Practical PyTorch: Translation with a Sequence to Sequence Network and Attention<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Practical-PyTorch:-Translation-with-a-Sequence-to-Sequence-Network-and-Attention">¶</a></h1><p>In this project we will be teaching a neural network to translate from French to English.</p>

<pre><code>[KEY: &gt; input, = target, &lt; output]

&gt; il est en train de peindre un tableau .
= he is painting a picture .
&lt; he is painting a picture .

&gt; pourquoi ne pas essayer ce vin delicieux ?
= why not try that delicious wine ?
&lt; why not try that delicious wine ?

&gt; elle n est pas poete mais romanciere .
= she is not a poet but a novelist .
&lt; she not not a poet but a novelist .

&gt; vous etes trop maigre .
= you re too skinny .
&lt; you re all alone .</code></pre>
<p>... to varying degrees of success.</p>
<p>This is made possible by the simple but powerful idea of the <a href="http://arxiv.org/abs/1409.3215">sequence to sequence network</a>, in which two recurrent neural networks work together to transform one sequence to another. An encoder network condenses an input sequence into a single vector, and a decoder network unfolds that vector into a new sequence.</p>
<p>To improve upon this model we'll use an <a href="https://arxiv.org/abs/1409.0473">attention mechanism</a>, which lets the decoder learn to focus over a specific range of the input sequence.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Sequence-to-Sequence-model">The Sequence to Sequence model<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#The-Sequence-to-Sequence-model">¶</a></h1><p>A <a href="http://arxiv.org/abs/1409.3215">Sequence to Sequence network</a>, or seq2seq network, or <a href="https://arxiv.org/pdf/1406.1078v3.pdf">Encoder Decoder network</a>, is a model consisting of two separate RNNs called the <strong>encoder</strong> and <strong>decoder</strong>. The encoder reads an input sequence one item at a time, and outputs a vector at each step. The final output of the encoder is kept as the <strong>context</strong> vector. The decoder uses this context vector to produce a sequence of outputs one step at a time.</p>
<p><img src="./Jupyter Notebook Viewer_files/tVtHhNp.png" alt=""></p>
<p>When using a single RNN, there is a one-to-one relationship between inputs and outputs. We would quickly run into problems with different sequence orders and lengths that are common during translation. Consider the simple sentence "Je ne suis pas le chat noir" → "I am not the black cat". Many of the words have a pretty direct translation, like "chat" → "cat". However the differing grammars cause words to be in different orders, e.g. "chat noir" and "black cat". There is also the "ne ... pas" → "not" construction that makes the two sentences have different lengths.</p>
<p>With the seq2seq model, by encoding many inputs into one vector, and decoding from one vector into many outputs, we are freed from the constraints of sequence order and length. The encoded sequence is represented by a single vector, a single point in some N dimensional space of sequences. In an ideal case, this point can be considered the "meaning" of the sequence.</p>
<p>This idea can be extended beyond sequences. Image captioning tasks take an <a href="https://arxiv.org/abs/1411.4555">image as input, and output a description</a> of the image (img2seq). Some image generation tasks take a <a href="https://arxiv.org/abs/1511.02793">description as input and output a generated image</a> (seq2img). These models can be referred to more generally as "encoder decoder" networks.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Attention-Mechanism">The Attention Mechanism<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#The-Attention-Mechanism">¶</a></h2><p>The fixed-length vector carries the burden of encoding the the entire "meaning" of the input sequence, no matter how long that may be. With all the variance in language, this is a very hard problem. Imagine two nearly identical sentences, twenty words long, with only one word different. Both the encoders and decoders must be nuanced enough to represent that change as a very slightly different point in space.</p>
<p>The <strong>attention mechanism</strong> <a href="https://arxiv.org/abs/1409.0473">introduced by Bahdanau et al.</a> addresses this by giving the decoder a way to "pay attention" to parts of the input, rather than relying on a single vector. For every step the decoder can select a different part of the input sentence to consider.</p>
<p><img src="./Jupyter Notebook Viewer_files/5y6SCvU.png" alt=""></p>
<p>Attention is calculated with another feedforward layer in the decoder. This layer will use the current input and hidden state to create a new vector, which is the same size as the input sequence (in practice, a fixed maximum length). This vector is processed through softmax to create <em>attention weights</em>, which are multiplied by the encoders' outputs to create a new context vector, which is then used to predict the next output.</p>
<p><img src="./Jupyter Notebook Viewer_files/K1qMPxs.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Requirements">Requirements<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Requirements">¶</a></h1><p>You will need <a href="http://pytorch.org/">PyTorch</a> to build and train the models, and <a href="https://matplotlib.org/">matplotlib</a> for plotting training and visualizing attention outputs later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="k">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="k">import</span> <span class="n">optim</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here we will also define a constant to decide whether to use the GPU (with CUDA specifically) or the CPU. <strong>If you don't have a GPU, set this to <code>False</code></strong>. Later when we create tensors, this variable will be used to decide whether we keep them on CPU or move them to GPU.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">USE_CUDA</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loading-data-files">Loading data files<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Loading-data-files">¶</a></h1><p>The data for this project is a set of many thousands of English to French translation pairs.</p>
<p><a href="http://opendata.stackexchange.com/questions/3888/dataset-of-sentences-translated-into-many-languages">This question on Open Data Stack Exchange</a> pointed me to the open translation site <a href="http://tatoeba.org/">http://tatoeba.org/</a> which has downloads available at <a href="http://tatoeba.org/eng/downloads">http://tatoeba.org/eng/downloads</a> - and better yet, someone did the extra work of splitting language pairs into individual text files here: <a href="http://www.manythings.org/anki/">http://www.manythings.org/anki/</a></p>
<p>The English to French pairs are too big to include in the repo, so download <code>fra-eng.zip</code>, extract the text file in there, and rename it to <code>data/eng-fra.txt</code> before continuing (for some reason the zipfile is named backwards). The file is a tab separated list of translation pairs:</p>

<pre><code>I am cold.    Je suis froid.</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similar to the character encoding used in the character-level RNN tutorials, we will be representing each word in a language as a one-hot vector, or giant vector of zeros except for a single one (at the index of the word). Compared to the dozens of characters that might exist in a language, there are many many more words, so the encoding vector is much larger. We will however cheat a bit and trim the data to only use a few thousand words per language.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Indexing-words">Indexing words<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Indexing-words">¶</a></h3><p>We'll need a unique index per word to use as the inputs and targets of the networks later. To keep track of all this we will use a helper class called <code>Lang</code> which has word → index (<code>word2index</code>) and index → word (<code>index2word</code>) dictionaries, as well as a count of each word <code>word2count</code> to use to later replace rare words.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SOS_token</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">EOS_token</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">Lang</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">word2index</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">word2count</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index2word</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">"SOS"</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">"EOS"</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_words</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Count SOS and EOS</span>
      
    <span class="k">def</span> <span class="nf">index_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">word2index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">word2index</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_words</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">word2count</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index2word</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_words</span><span class="p">]</span> <span class="o">=</span> <span class="n">word</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_words</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">word2count</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Reading-and-decoding-files">Reading and decoding files<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Reading-and-decoding-files">¶</a></h3><p>The files are all in Unicode, to simplify we will turn Unicode characters to ASCII, make everything lowercase, and trim most punctuation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Turn a Unicode string to plain ASCII, thanks to http://stackoverflow.com/a/518232/2809427</span>
<span class="k">def</span> <span class="nf">unicode_to_ascii</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">'NFD'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">'Mn'</span>
    <span class="p">)</span>

<span class="c1"># Lowercase, trim, and remove non-letter characters</span>
<span class="k">def</span> <span class="nf">normalize_string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">unicode_to_ascii</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"([.!?])"</span><span class="p">,</span> <span class="sa">r</span><span class="s2">" \1"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[^a-zA-Z.!?]+"</span><span class="p">,</span> <span class="sa">r</span><span class="s2">" "</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To read the data file we will split the file into lines, and then split lines into pairs. The files are all English → Other Language, so if we want to translate from Other Language → English I added the <code>reverse</code> flag to reverse the pairs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">read_langs</span><span class="p">(</span><span class="n">lang1</span><span class="p">,</span> <span class="n">lang2</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Reading lines..."</span><span class="p">)</span>

    <span class="c1"># Read the file and split into lines</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'../data/</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">.txt'</span> <span class="o">%</span> <span class="p">(</span><span class="n">lang1</span><span class="p">,</span> <span class="n">lang2</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    
    <span class="c1"># Split every line into pairs and normalize</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">normalize_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">)]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    
    <span class="c1"># Reverse pairs, make Lang instances</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">]</span>
        <span class="n">input_lang</span> <span class="o">=</span> <span class="n">Lang</span><span class="p">(</span><span class="n">lang2</span><span class="p">)</span>
        <span class="n">output_lang</span> <span class="o">=</span> <span class="n">Lang</span><span class="p">(</span><span class="n">lang1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">input_lang</span> <span class="o">=</span> <span class="n">Lang</span><span class="p">(</span><span class="n">lang1</span><span class="p">)</span>
        <span class="n">output_lang</span> <span class="o">=</span> <span class="n">Lang</span><span class="p">(</span><span class="n">lang2</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">input_lang</span><span class="p">,</span> <span class="n">output_lang</span><span class="p">,</span> <span class="n">pairs</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Filtering-sentences">Filtering sentences<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Filtering-sentences">¶</a></h3><p>Since there are a <em>lot</em> of example sentences and we want to train something quickly, we'll trim the data set to only relatively short and simple sentences. Here the maximum length is 10 words (that includes punctuation) and we're filtering to sentences that translate to the form "I am" or "He is" etc. (accounting for apostrophes being removed).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">good_prefixes</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">"i am "</span><span class="p">,</span> <span class="s2">"i m "</span><span class="p">,</span>
    <span class="s2">"he is"</span><span class="p">,</span> <span class="s2">"he s "</span><span class="p">,</span>
    <span class="s2">"she is"</span><span class="p">,</span> <span class="s2">"she s"</span><span class="p">,</span>
    <span class="s2">"you are"</span><span class="p">,</span> <span class="s2">"you re "</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_pair</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">MAX_LENGTH</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">MAX_LENGTH</span> <span class="ow">and</span> \
        <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">good_prefixes</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_pairs</span><span class="p">(</span><span class="n">pairs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">pair</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span> <span class="k">if</span> <span class="n">filter_pair</span><span class="p">(</span><span class="n">pair</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The full process for preparing the data is:</p>
<ul>
<li>Read text file and split into lines, split lines into pairs</li>
<li>Normalize text, filter by length and content</li>
<li>Make word lists from sentences in pairs</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prepare_data</span><span class="p">(</span><span class="n">lang1_name</span><span class="p">,</span> <span class="n">lang2_name</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">input_lang</span><span class="p">,</span> <span class="n">output_lang</span><span class="p">,</span> <span class="n">pairs</span> <span class="o">=</span> <span class="n">read_langs</span><span class="p">(</span><span class="n">lang1_name</span><span class="p">,</span> <span class="n">lang2_name</span><span class="p">,</span> <span class="n">reverse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Read </span><span class="si">%s</span><span class="s2"> sentence pairs"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">))</span>
    
    <span class="n">pairs</span> <span class="o">=</span> <span class="n">filter_pairs</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Trimmed to </span><span class="si">%s</span><span class="s2"> sentence pairs"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Indexing words..."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="n">input_lang</span><span class="o">.</span><span class="n">index_words</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">output_lang</span><span class="o">.</span><span class="n">index_words</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">input_lang</span><span class="p">,</span> <span class="n">output_lang</span><span class="p">,</span> <span class="n">pairs</span>

<span class="n">input_lang</span><span class="p">,</span> <span class="n">output_lang</span><span class="p">,</span> <span class="n">pairs</span> <span class="o">=</span> <span class="n">prepare_data</span><span class="p">(</span><span class="s1">'eng'</span><span class="p">,</span> <span class="s1">'fra'</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Print an example pair</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">pairs</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Reading lines...
Read 135842 sentence pairs
Trimmed to 9129 sentence pairs
Indexing words...
['il est paresseux .', 'he s lazy .']
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Turning-training-data-into-Tensors/Variables">Turning training data into Tensors/Variables<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Turning-training-data-into-Tensors/Variables">¶</a></h2><p>To train we need to turn the sentences into something the neural network can understand, which of course means numbers. Each sentence will be split into words and turned into a Tensor, where each word is replaced with the index (from the Lang indexes made earlier). While creating these tensors we will also append the EOS token to signal that the sentence is over.</p>
<p><img src="./Jupyter Notebook Viewer_files/LzocpGH.png" alt=""></p>
<p>A Tensor is a multi-dimensional array of numbers, defined with some type e.g. FloatTensor or LongTensor. In this case we'll be using LongTensor to represent an array of integer indexes.</p>
<p>Trainable PyTorch modules take Variables as input, rather than plain Tensors. A Variable is basically a Tensor that is able to keep track of the graph state, which is what makes autograd (automatic calculation of backwards gradients) possible.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Return a list of indexes, one for each word in the sentence</span>
<span class="k">def</span> <span class="nf">indexes_from_sentence</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">lang</span><span class="o">.</span><span class="n">word2index</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">variable_from_sentence</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="n">indexes_from_sentence</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>
    <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EOS_token</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1">#     print('var =', var)</span>
    <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span> <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">var</span>

<span class="k">def</span> <span class="nf">variables_from_pair</span><span class="p">(</span><span class="n">pair</span><span class="p">):</span>
    <span class="n">input_variable</span> <span class="o">=</span> <span class="n">variable_from_sentence</span><span class="p">(</span><span class="n">input_lang</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">target_variable</span> <span class="o">=</span> <span class="n">variable_from_sentence</span><span class="p">(</span><span class="n">output_lang</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">input_variable</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Building-the-models">Building the models<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Building-the-models">¶</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Encoder">The Encoder<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#The-Encoder">¶</a></h2><p><img src="./Jupyter Notebook Viewer_files/encoder-network.png" style="float: right"></p>
<p>The encoder of a seq2seq network is a RNN that outputs some value for every word from the input sentence. For every input word the encoder outputs a vector and a hidden state, and uses the hidden state for the next input word.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EncoderRNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EncoderRNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">input_size</span> <span class="o">=</span> <span class="n">input_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hidden_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">n_layers</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gru</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word_inputs</span><span class="p">,</span> <span class="n">hidden</span><span class="p">):</span>
        <span class="c1"># Note: we run this all at once (over the whole input sequence)</span>
        <span class="n">seq_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_inputs</span><span class="p">)</span>
        <span class="n">embedded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">word_inputs</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">seq_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">hidden</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gru</span><span class="p">(</span><span class="n">embedded</span><span class="p">,</span> <span class="n">hidden</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">hidden</span>

    <span class="k">def</span> <span class="nf">init_hidden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hidden</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span> <span class="n">hidden</span> <span class="o">=</span> <span class="n">hidden</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hidden</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Attention-Decoder">Attention Decoder<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Attention-Decoder">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Interpreting-the-Bahdanau-et-al.-model">Interpreting the Bahdanau et al. model<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Interpreting-the-Bahdanau-et-al.-model">¶</a></h3><p>The attention model in <a href="https://arxiv.org/abs/1409.0473">Neural Machine Translation by Jointly Learning to Align and Translate</a> is described as the following series of equations.</p>
<p>Each decoder output is conditioned on the previous outputs and some <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.876em 1000.53em 2.696em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="texatom" id="MathJax-Span-3"><span class="mrow" id="MathJax-Span-4"><span class="mi" id="MathJax-Span-5" style="font-family: STIXGeneral; font-weight: bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-1">\mathbf x</script>, where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-6" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.876em 1000.53em 2.696em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-7"><span class="texatom" id="MathJax-Span-8"><span class="mrow" id="MathJax-Span-9"><span class="mi" id="MathJax-Span-10" style="font-family: STIXGeneral; font-weight: bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2">\mathbf x</script> consists of the current hidden state (which takes into account previous outputs) and the attention "context", which is calculated below. The function <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-11" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.876em 1000.53em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-12"><span class="mi" id="MathJax-Span-13" style="font-family: STIXGeneral; font-style: italic;">g</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">g</script> is a fully-connected layer with a nonlinear activation, which takes as input the values <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-14" style="width: 1.935em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.58em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-15"><span class="msubsup" id="MathJax-Span-16"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-17" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-18"><span class="mrow" id="MathJax-Span-19"><span class="mi" id="MathJax-Span-20" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-21" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-22" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-4">y_{i-1}</script>, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-23" style="width: 0.823em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.65em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-24"><span class="msubsup" id="MathJax-Span-25"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-26" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-27" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-5">s_i</script>, and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-28" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-29"><span class="msubsup" id="MathJax-Span-30"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-32" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">c_i</script> concatenated.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2223;&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-33" style="width: 18.797em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.401em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1015.34em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-34"><span class="mi" id="MathJax-Span-35" style="font-family: STIXGeneral; font-style: italic;">p</span><span class="mo" id="MathJax-Span-36" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-37"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-38" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-39" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-40" style="font-family: STIXGeneral; padding-left: 0.296em;">∣</span><span class="mo" id="MathJax-Span-41" style="font-family: STIXGeneral; padding-left: 0.296em;">{</span><span class="msubsup" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-43" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mn" id="MathJax-Span-44" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-45" style="font-family: STIXGeneral;">,</span><span class="mo" id="MathJax-Span-46" style="font-family: STIXGeneral; padding-left: 0.179em;">.</span><span class="mo" id="MathJax-Span-47" style="font-family: STIXGeneral; padding-left: 0.179em;">.</span><span class="mo" id="MathJax-Span-48" style="font-family: STIXGeneral; padding-left: 0.179em;">.</span><span class="mo" id="MathJax-Span-49" style="font-family: STIXGeneral; padding-left: 0.179em;">,</span><span class="msubsup" id="MathJax-Span-50" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-51" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-52"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-55" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-56" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-57" style="font-family: STIXGeneral;">}</span><span class="mo" id="MathJax-Span-58" style="font-family: STIXGeneral;">,</span><span class="texatom" id="MathJax-Span-59" style="padding-left: 0.179em;"><span class="mrow" id="MathJax-Span-60"><span class="mi" id="MathJax-Span-61" style="font-family: STIXGeneral; font-weight: bold;">x</span></span></span><span class="mo" id="MathJax-Span-62" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-63" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mi" id="MathJax-Span-64" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.296em;">g</span><span class="mo" id="MathJax-Span-65" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-66"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-67" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-68"><span class="mrow" id="MathJax-Span-69"><span class="mi" id="MathJax-Span-70" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-71" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-72" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-73" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-74" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-75" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-76" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-77" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-78" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-79" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-80" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-81" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>p</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>∣</mo><mo fence="false" stretchy="false">{</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="false" stretchy="false">}</mo><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>s</mi><mi>i</mi></msub><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-7">
p(y_i \mid \{y_1,...,y_{i-1}\},\mathbf{x}) = g(y_{i-1}, s_i, c_i)
</script></p>
<p>The current hidden state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-82" style="width: 0.823em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.65em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-83"><span class="msubsup" id="MathJax-Span-84"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-85" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-86" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-8">s_i</script> is calculated by an RNN <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-87" style="width: 0.53em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.413em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1000.41em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-88"><span class="mi" id="MathJax-Span-89" style="font-family: STIXGeneral; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">f</script> with the last hidden state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-90" style="width: 1.876em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.52em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-91"><span class="msubsup" id="MathJax-Span-92"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-93" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-94"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-97" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-98" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-10">s_{i-1}</script>, last decoder output value <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-99" style="width: 1.935em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.58em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-100"><span class="msubsup" id="MathJax-Span-101"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-102" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-103"><span class="mrow" id="MathJax-Span-104"><span class="mi" id="MathJax-Span-105" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-106" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-107" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">y_{i-1}</script>, and context vector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-108" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-109"><span class="msubsup" id="MathJax-Span-110"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-111" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-112" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-12">c_i</script>.</p>
<p>In the code, the RNN will be a <code>nn.GRU</code> layer, the hidden state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-113" style="width: 0.823em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.65em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-114"><span class="msubsup" id="MathJax-Span-115"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-116" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-117" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-13">s_i</script> will be called <code>hidden</code>, the output <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-118" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-119"><span class="msubsup" id="MathJax-Span-120"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-121" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-122" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-14">y_i</script> called <code>output</code>, and context <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-123" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-124"><span class="msubsup" id="MathJax-Span-125"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-126" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-127" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-15">c_i</script> called <code>context</code>.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-128" style="width: 9.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.673em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1007.61em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-129"><span class="msubsup" id="MathJax-Span-130"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-131" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-132" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-133" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mi" id="MathJax-Span-134" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.296em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span><span class="mo" id="MathJax-Span-135" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-136"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-137" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-138"><span class="mrow" id="MathJax-Span-139"><span class="mi" id="MathJax-Span-140" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-141" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-142" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-143" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-144" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-145" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-146"><span class="mrow" id="MathJax-Span-147"><span class="mi" id="MathJax-Span-148" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-149" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-150" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-151" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-152" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-153" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-154" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-155" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-16">
s_i = f(s_{i-1}, y_{i-1}, c_i)
</script></p>
<p>The context vector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-156" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-157"><span class="msubsup" id="MathJax-Span-158"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-159" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-160" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-17">c_i</script> is a weighted sum of all encoder outputs, where each weight <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-161" style="width: 1.232em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-162"><span class="msubsup" id="MathJax-Span-163"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-164" style="font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="texatom" id="MathJax-Span-165"><span class="mrow" id="MathJax-Span-166"><span class="mi" id="MathJax-Span-167" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-168" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-18">a_{ij}</script> is the amount of "attention" paid to the corresponding encoder output <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-169" style="width: 0.94em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.291em 1000.76em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-170"><span class="msubsup" id="MathJax-Span-171"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-172" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-173" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>h</mi><mi>j</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-19">h_j</script>.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-174" style="width: 6.385em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.214em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(0.588em 1005.21em 4.101em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-175"><span class="msubsup" id="MathJax-Span-176"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-177" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-178" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-179" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="munderover" id="MathJax-Span-180" style="padding-left: 0.296em;"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(2.813em 1001.23em 4.628em -999.997em); top: -3.978em; left: 0em;"><span class="mo" id="MathJax-Span-181" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.34em 1000.94em 4.394em -999.997em); top: -2.807em; left: 0.12em;"><span class="texatom" id="MathJax-Span-182"><span class="mrow" id="MathJax-Span-183"><span class="mi" id="MathJax-Span-184" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-185" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mn" id="MathJax-Span-186" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.65em 4.277em -999.997em); top: -5.208em; left: 0.296em;"><span class="texatom" id="MathJax-Span-187"><span class="mrow" id="MathJax-Span-188"><span class="msubsup" id="MathJax-Span-189"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-190" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.061em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.861em; left: 0.413em;"><span class="mi" id="MathJax-Span-191" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-192" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-193" style="font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="texatom" id="MathJax-Span-194"><span class="mrow" id="MathJax-Span-195"><span class="mi" id="MathJax-Span-196" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-197" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-198"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-199" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-200" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.782em; border-left: 0px solid; width: 0px; height: 4.004em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>T</mi><mi>x</mi></msub></mrow></munderover><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>h</mi><mi>j</mi></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-20">
c_i = \sum_{j=1}^{T_x} a_{ij} h_j
</script></p>
<p>... where each weight <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-201" style="width: 1.232em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-202"><span class="msubsup" id="MathJax-Span-203"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-204" style="font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="texatom" id="MathJax-Span-205"><span class="mrow" id="MathJax-Span-206"><span class="mi" id="MathJax-Span-207" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-208" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-21">a_{ij}</script> is a normalized (over all steps) attention "energy" <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-209" style="width: 1.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.94em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-210"><span class="msubsup" id="MathJax-Span-211"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-212" style="font-family: STIXGeneral; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-213"><span class="mrow" id="MathJax-Span-214"><span class="mi" id="MathJax-Span-215" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-216" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-22">e_{ij}</script> ...</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle displaystyle=&quot;true&quot; scriptlevel=&quot;0&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mstyle&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-217" style="width: 9.898em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.083em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(0.881em 1008.08em 3.926em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-218"><span class="msubsup" id="MathJax-Span-219"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-220" style="font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="texatom" id="MathJax-Span-221"><span class="mrow" id="MathJax-Span-222"><span class="mi" id="MathJax-Span-223" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-224" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-225" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mstyle" id="MathJax-Span-226" style="padding-left: 0.296em;"><span class="mrow" id="MathJax-Span-227"><span class="mfrac" id="MathJax-Span-228"><span style="display: inline-block; position: relative; width: 5.565em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.106em 1002.93em 4.453em -999.997em); top: -4.739em; left: 50%; margin-left: -1.461em;"><span class="mrow" id="MathJax-Span-229"><span class="mi" id="MathJax-Span-230" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mi" id="MathJax-Span-231" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-232" style="font-family: STIXGeneral; font-style: italic;">p</span><span class="mo" id="MathJax-Span-233" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-234"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-235" style="font-family: STIXGeneral; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-236"><span class="mrow" id="MathJax-Span-237"><span class="mi" id="MathJax-Span-238" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-239" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-240" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(2.872em 1005.39em 4.453em -999.997em); top: -3.042em; left: 50%; margin-left: -2.69em;"><span class="mrow" id="MathJax-Span-241"><span class="munderover" id="MathJax-Span-242"><span style="display: inline-block; position: relative; width: 2.169em; height: 0px;"><span style="position: absolute; clip: rect(3.047em 1000.88em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mo" id="MathJax-Span-243" style="font-family: STIXGeneral; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.34em 1000.53em 4.16em -999.997em); top: -4.447em; left: 0.94em;"><span class="texatom" id="MathJax-Span-244"><span class="mrow" id="MathJax-Span-245"><span class="mi" id="MathJax-Span-246" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.061em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.34em 1001.23em 4.16em -999.997em); top: -3.686em; left: 0.94em;"><span class="texatom" id="MathJax-Span-247"><span class="mrow" id="MathJax-Span-248"><span class="mi" id="MathJax-Span-249" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-250" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mn" id="MathJax-Span-251" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mi" id="MathJax-Span-252" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.179em;">e</span><span class="mi" id="MathJax-Span-253" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-254" style="font-family: STIXGeneral; font-style: italic;">p</span><span class="mo" id="MathJax-Span-255" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-256"><span style="display: inline-block; position: relative; width: 1.057em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-257" style="font-family: STIXGeneral; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-258"><span class="mrow" id="MathJax-Span-259"><span class="mi" id="MathJax-Span-260" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-261" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-262" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(0.823em 1005.57em 1.232em -999.997em); top: -1.285em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.565em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.568em; border-left: 0px solid; width: 0px; height: 3.432em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>T</mi></mrow></munderover><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mfrac></mstyle></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-23">
a_{ij} = \dfrac{exp(e_{ij})}{\sum_{k=1}^{T} exp(e_{ik})}
</script></p>
<p>... where each attention energy is calculated with some function <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-263" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.876em 1000.53em 2.696em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-264"><span class="mi" id="MathJax-Span-265" style="font-family: STIXGeneral; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">a</script> (such as another linear layer) using the last hidden state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-266" style="width: 1.876em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.52em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-267"><span class="msubsup" id="MathJax-Span-268"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-269" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-270"><span class="mrow" id="MathJax-Span-271"><span class="mi" id="MathJax-Span-272" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-273" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-274" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-25">s_{i-1}</script> and that particular encoder output <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-275" style="width: 0.94em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.291em 1000.76em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-276"><span class="msubsup" id="MathJax-Span-277"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-278" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-279" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>h</mi><mi>j</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-26">h_j</script>:</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-280" style="width: 7.439em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.092em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1006.03em 2.989em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-281"><span class="msubsup" id="MathJax-Span-282"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-283" style="font-family: STIXGeneral; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-284"><span class="mrow" id="MathJax-Span-285"><span class="mi" id="MathJax-Span-286" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-287" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-288" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mi" id="MathJax-Span-289" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.296em;">a</span><span class="mo" id="MathJax-Span-290" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-291"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-292" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-293"><span class="mrow" id="MathJax-Span-294"><span class="mi" id="MathJax-Span-295" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-296" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-297" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-298" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-299" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-300" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-301" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-302" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>a</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>h</mi><mi>j</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-27">
e_{ij} = a(s_{i-1}, h_j)
</script></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Implementing-the-Bahdanau-et-al.-model">Implementing the Bahdanau et al. model<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Implementing-the-Bahdanau-et-al.-model">¶</a></h3><p>In summary our decoder should consist of four main parts - an embedding layer turning an input word into a vector; a layer to calculate the attention energy per encoder output; a RNN layer; and an output layer.</p>
<p>The decoder's inputs are the last RNN hidden state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-303" style="width: 1.876em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.52em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-304"><span class="msubsup" id="MathJax-Span-305"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-306" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-307"><span class="mrow" id="MathJax-Span-308"><span class="mi" id="MathJax-Span-309" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-310" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-311" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-28">s_{i-1}</script>, last output <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-312" style="width: 1.935em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.58em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-313"><span class="msubsup" id="MathJax-Span-314"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-315" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-316"><span class="mrow" id="MathJax-Span-317"><span class="mi" id="MathJax-Span-318" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-319" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-320" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-29">y_{i-1}</script>, and all encoder outputs <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-321" style="width: 1.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.291em 1000.94em 2.462em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-322"><span class="msubsup" id="MathJax-Span-323"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-324" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mo" id="MathJax-Span-325" style="font-size: 70.7%; font-family: STIXGeneral;">∗</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.211em; border-left: 0px solid; width: 0px; height: 1.146em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>h</mi><mo>∗</mo></msub></math></span></span><script type="math/tex" id="MathJax-Element-30">h_*</script>.</p>
<ul>
<li>embedding layer with inputs <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-326" style="width: 1.935em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001.58em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-327"><span class="msubsup" id="MathJax-Span-328"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-329" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-330"><span class="mrow" id="MathJax-Span-331"><span class="mi" id="MathJax-Span-332" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-333" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-334" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.004em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-31">y_{i-1}</script><ul>
<li><code>embedded = embedding(last_rnn_output)</code></li>
</ul>
</li>
<li>attention layer <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-335" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.876em 1000.53em 2.696em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-336"><span class="mi" id="MathJax-Span-337" style="font-family: STIXGeneral; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.068em; border-left: 0px solid; width: 0px; height: 0.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-32">a</script> with inputs <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-338" style="width: 4.16em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.399em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1003.34em 2.989em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-339"><span class="mo" id="MathJax-Span-340" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-341"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-342" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-343"><span class="mrow" id="MathJax-Span-344"><span class="mi" id="MathJax-Span-345" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-346" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-347" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-348" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-349" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-350" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-351" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-352" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.361em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>h</mi><mi>j</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-33">(s_{i-1}, h_j)</script> and outputs <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-353" style="width: 1.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.94em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-354"><span class="msubsup" id="MathJax-Span-355"><span style="display: inline-block; position: relative; width: 0.94em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-356" style="font-family: STIXGeneral; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-357"><span class="mrow" id="MathJax-Span-358"><span class="mi" id="MathJax-Span-359" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-360" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-34">e_{ij}</script>, normalized to create <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-361" style="width: 1.232em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1001em 2.638em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-362"><span class="msubsup" id="MathJax-Span-363"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-364" style="font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="texatom" id="MathJax-Span-365"><span class="mrow" id="MathJax-Span-366"><span class="mi" id="MathJax-Span-367" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-368" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.425em; border-left: 0px solid; width: 0px; height: 1.075em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-35">a_{ij}</script><ul>
<li><code>attn_energies[j] = attn_layer(last_hidden, encoder_outputs[j])</code></li>
<li><code>attn_weights = normalize(attn_energies)</code></li>
</ul>
</li>
<li>context vector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-369" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-370"><span class="msubsup" id="MathJax-Span-371"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-372" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-373" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>c</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-36">c_i</script> as an attention-weighted average of encoder outputs<ul>
<li><code>context = sum(attn_weights * encoder_outputs)</code></li>
</ul>
</li>
<li>RNN layer(s) <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-374" style="width: 0.53em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.413em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1000.41em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-375"><span class="mi" id="MathJax-Span-376" style="font-family: STIXGeneral; font-style: italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math></span></span><script type="math/tex" id="MathJax-Element-37">f</script> with inputs <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-377" style="width: 6.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.331em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1005.27em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-378"><span class="mo" id="MathJax-Span-379" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-380"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-381" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="texatom" id="MathJax-Span-382"><span class="mrow" id="MathJax-Span-383"><span class="mi" id="MathJax-Span-384" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-385" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-386" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-387" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-388" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-389" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-390"><span class="mrow" id="MathJax-Span-391"><span class="mi" id="MathJax-Span-392" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-393" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-394" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-395" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-396" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-397" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-398" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-399" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-38">(s_{i-1}, y_{i-1}, c_i)</script> and internal hidden state, outputting <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-400" style="width: 0.823em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.65em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-401"><span class="msubsup" id="MathJax-Span-402"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-403" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-404" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-39">s_i</script><ul>
<li><code>rnn_input = concat(embedded, context)</code></li>
<li><code>rnn_output, rnn_hidden = rnn(rnn_input, last_hidden)</code></li>
</ul>
</li>
<li>an output layer <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-405" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.876em 1000.53em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-406"><span class="mi" id="MathJax-Span-407" style="font-family: STIXGeneral; font-style: italic;">g</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi></math></span></span><script type="math/tex" id="MathJax-Element-40">g</script> with inputs <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-408" style="width: 5.448em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.453em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em 1004.39em 2.93em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-409"><span class="mo" id="MathJax-Span-410" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-411"><span style="display: inline-block; position: relative; width: 1.584em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-412" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="texatom" id="MathJax-Span-413"><span class="mrow" id="MathJax-Span-414"><span class="mi" id="MathJax-Span-415" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span class="mo" id="MathJax-Span-416" style="font-size: 70.7%; font-family: STIXGeneral;">−</span><span class="mn" id="MathJax-Span-417" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-418" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-419" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.35em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-420" style="font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.413em;"><span class="mi" id="MathJax-Span-421" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-422" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-423" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-424" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-425" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-426" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 1.289em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>s</mi><mi>i</mi></msub><mo>,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-41">(y_{i-1}, s_i, c_i)</script>, outputting <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-427" style="width: 0.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.71em 2.579em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-428"><span class="msubsup" id="MathJax-Span-429"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-430" style="font-family: STIXGeneral; font-style: italic;">y</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-431" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.354em; border-left: 0px solid; width: 0px; height: 0.932em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-42">y_i</script><ul>
<li><code>output = out(embedded, rnn_output, context)</code></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BahdanauAttnDecoderRNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dropout_p</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AttnDecoderRNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1"># Define parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hidden_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">output_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">n_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout_p</span> <span class="o">=</span> <span class="n">dropout_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>
        
        <span class="c1"># Define layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attn</span> <span class="o">=</span> <span class="n">GeneralAttn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gru</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word_input</span><span class="p">,</span> <span class="n">last_hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">):</span>
        <span class="c1"># Note that we will only be running forward for a single decoder time step, but will use all encoder outputs</span>
        
        <span class="c1"># Get the embedding of the current input word (last output word)</span>
        <span class="n">word_embedded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">word_input</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># S=1 x B x N</span>
        <span class="n">word_embedded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">word_embedded</span><span class="p">)</span>
        
        <span class="c1"># Calculate attention weights and apply to encoder outputs</span>
        <span class="n">attn_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn</span><span class="p">(</span><span class="n">last_hidden</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">encoder_outputs</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">attn_weights</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span><span class="n">encoder_outputs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># B x 1 x N</span>
        
        <span class="c1"># Combine embedded input word and attended context, run through RNN</span>
        <span class="n">rnn_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">word_embedded</span><span class="p">,</span> <span class="n">context</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">hidden</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gru</span><span class="p">(</span><span class="n">rnn_input</span><span class="p">,</span> <span class="n">last_hidden</span><span class="p">)</span>
        
        <span class="c1"># Final output layer</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># B x N</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span>
        
        <span class="c1"># Return final output, hidden state, and attention weights (for visualization)</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">attn_weights</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Interpreting-the-Luong-et-al.-model(s)">Interpreting the Luong et al. model(s)<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Interpreting-the-Luong-et-al.-model(s)">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://arxiv.org/abs/1508.04025">Effective Approaches to Attention-based Neural Machine Translation</a> by Luong et al. describe a few more attention models that offer improvements and simplifications. They describe a few "global attention" models, the distinction between them being the way the attention scores are calculated.</p>
<p>The general form of the attention calculation relies on the target (decoder) side hidden state and corresponding source (encoder) side state, normalized over all states to get values summing to 1:</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle displaystyle=&quot;true&quot; scriptlevel=&quot;0&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mstyle&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-432" style="width: 22.427em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.387em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(0.764em 1018.39em 3.867em -999.997em); top: -2.515em; left: 0em;"><span class="mrow" id="MathJax-Span-433"><span class="msubsup" id="MathJax-Span-434"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-435" style="font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-436" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-437" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-438" style="font-family: STIXGeneral; font-style: italic;">s</span><span class="mo" id="MathJax-Span-439" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-440" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mi" id="MathJax-Span-441" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.296em;">a</span><span class="mi" id="MathJax-Span-442" style="font-family: STIXGeneral; font-style: italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-443" style="font-family: STIXGeneral; font-style: italic;">i</span><span class="mi" id="MathJax-Span-444" style="font-family: STIXGeneral; font-style: italic;">g</span><span class="mi" id="MathJax-Span-445" style="font-family: STIXGeneral; font-style: italic;">n</span><span class="mo" id="MathJax-Span-446" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-447"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-448" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-449" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-450" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-451" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-452"><span class="mrow" id="MathJax-Span-453"><span class="munderover" id="MathJax-Span-454"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-455" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-456" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-457" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-458" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-459" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mstyle" id="MathJax-Span-460" style="padding-left: 0.296em;"><span class="mrow" id="MathJax-Span-461"><span class="mfrac" id="MathJax-Span-462"><span style="display: inline-block; position: relative; width: 9.019em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.93em 1006.91em 4.394em -999.997em); top: -4.681em; left: 50%; margin-left: -3.51em;"><span class="mrow" id="MathJax-Span-463"><span class="mi" id="MathJax-Span-464" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mi" id="MathJax-Span-465" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-466" style="font-family: STIXGeneral; font-style: italic;">p</span><span class="mo" id="MathJax-Span-467" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-468" style="font-family: STIXGeneral; font-style: italic;">s</span><span class="mi" id="MathJax-Span-469" style="font-family: STIXGeneral; font-style: italic;">c</span><span class="mi" id="MathJax-Span-470" style="font-family: STIXGeneral; font-style: italic;">o</span><span class="mi" id="MathJax-Span-471" style="font-family: STIXGeneral; font-style: italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-472" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mo" id="MathJax-Span-473" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-474"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-475" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-476" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-477" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-478" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-479"><span class="mrow" id="MathJax-Span-480"><span class="munderover" id="MathJax-Span-481"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-482" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-483" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-484" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-485" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-486" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(2.93em 1008.84em 4.453em -999.997em); top: -3.1em; left: 50%; margin-left: -4.447em;"><span class="mrow" id="MathJax-Span-487"><span class="munderover" id="MathJax-Span-488"><span style="display: inline-block; position: relative; width: 1.467em; height: 0px;"><span style="position: absolute; clip: rect(3.047em 1000.88em 4.394em -999.997em); top: -3.978em; left: 0em;"><span class="mo" id="MathJax-Span-489" style="font-family: STIXGeneral; vertical-align: 0.003em;">∑</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.686em; left: 0.94em;"><span class="texatom" id="MathJax-Span-490"><span class="mrow" id="MathJax-Span-491"><span class="msup" id="MathJax-Span-492"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.516em 1000.24em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-493" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -4.154em; left: 0.296em;"><span class="mo" id="MathJax-Span-494" style="font-size: 50%; font-family: STIXVariants;">′</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mi" id="MathJax-Span-495" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.179em;">e</span><span class="mi" id="MathJax-Span-496" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-497" style="font-family: STIXGeneral; font-style: italic;">p</span><span class="mo" id="MathJax-Span-498" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-499" style="font-family: STIXGeneral; font-style: italic;">s</span><span class="mi" id="MathJax-Span-500" style="font-family: STIXGeneral; font-style: italic;">c</span><span class="mi" id="MathJax-Span-501" style="font-family: STIXGeneral; font-style: italic;">o</span><span class="mi" id="MathJax-Span-502" style="font-family: STIXGeneral; font-style: italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-503" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mo" id="MathJax-Span-504" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-505"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-506" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-507" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-508" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-509" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 1.057em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-510"><span class="mrow" id="MathJax-Span-511"><span class="munderover" id="MathJax-Span-512"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-513" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-514" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="texatom" id="MathJax-Span-515"><span class="mrow" id="MathJax-Span-516"><span class="msup" id="MathJax-Span-517"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.516em 1000.24em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-518" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -4.154em; left: 0.296em;"><span class="mo" id="MathJax-Span-519" style="font-size: 50%; font-family: STIXVariants;">′</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-520" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-521" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(0.823em 1009.02em 1.232em -999.997em); top: -1.285em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 9.019em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.52em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.496em; border-left: 0px solid; width: 0px; height: 3.504em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>=</mo><mi>a</mi><mi>l</mi><mi>i</mi><mi>g</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>h</mi><mi>t</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mi>s</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo stretchy="false">(</mo><msub><mi>h</mi><mi>t</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mi>s</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>s</mi><mo>′</mo></msup></mrow></munder><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo stretchy="false">(</mo><msub><mi>h</mi><mi>t</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mrow class="MJX-TeXAtom-ORD"><msup><mi>s</mi><mo>′</mo></msup></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mfrac></mstyle></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-43">
a_t(s) = align(h_t, \bar h_s)  = \dfrac{exp(score(h_t, \bar h_s))}{\sum_{s'} exp(score(h_t, \bar h_{s'}))}
</script></p>
<p>The specific "score" function that compares two states is either <em>dot</em>, a simple dot product between the states; <em>general</em>, a a dot product between the decoder hidden state and a linear transform of the encoder state; or <em>concat</em>, a dot product between a new parameter <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-522" style="width: 1.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.525em 1000.88em 2.52em -999.997em); top: -2.163em; left: 0em;"><span class="mrow" id="MathJax-Span-523"><span class="msubsup" id="MathJax-Span-524"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-525" style="font-family: STIXGeneral; font-style: italic;">v</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-526" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.169em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.282em; border-left: 0px solid; width: 0px; height: 0.861em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>v</mi><mi>a</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-44">v_a</script> and a linear transform of the states concatenated together.</p>
<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;{&lt;/mo&gt;&lt;mtable columnalign=&quot;left left&quot; rowspacing=&quot;.2em&quot; columnspacing=&quot;1em&quot; displaystyle=&quot;false&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A4;&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A4;&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext mathvariant=&quot;bold&quot;&gt;W&lt;/mtext&gt;&lt;/mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A4;&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtext mathvariant=&quot;bold&quot;&gt;W&lt;/mtext&gt;&lt;/mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x00AF;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo fence=&quot;true&quot; stretchy=&quot;true&quot; symmetric=&quot;true&quot;&gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-527" style="width: 20.261em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.572em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(2.169em 1016.57em 6.268em -999.997em); top: -4.447em; left: 0em;"><span class="mrow" id="MathJax-Span-528"><span class="mi" id="MathJax-Span-529" style="font-family: STIXGeneral; font-style: italic;">s</span><span class="mi" id="MathJax-Span-530" style="font-family: STIXGeneral; font-style: italic;">c</span><span class="mi" id="MathJax-Span-531" style="font-family: STIXGeneral; font-style: italic;">o</span><span class="mi" id="MathJax-Span-532" style="font-family: STIXGeneral; font-style: italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-533" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mo" id="MathJax-Span-534" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-535"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-536" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-537" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-538" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-539" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-540"><span class="mrow" id="MathJax-Span-541"><span class="munderover" id="MathJax-Span-542"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-543" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-544" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-545" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-546" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-547" style="font-family: STIXGeneral; padding-left: 0.296em;">=</span><span class="mrow" id="MathJax-Span-548" style="padding-left: 0.296em;"><span class="mo" id="MathJax-Span-549" style="vertical-align: 2.111em;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; font-family: STIXSizeOneSym; top: -3.276em; left: 0em;">⎧<span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; font-family: STIXSizeOneSym; top: -0.524em; left: 0em;">⎩<span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; font-family: STIXSizeOneSym; top: -1.871em; left: 0em;">⎨<span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="font-family: STIXSizeOneSym; position: absolute; top: -2.573em; left: 0em;">⎪<span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="font-family: STIXSizeOneSym; position: absolute; top: -1.227em; left: 0em;">⎪<span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mtable" id="MathJax-Span-550" style="padding-right: 0.179em; padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 9.371em; height: 0px;"><span style="position: absolute; clip: rect(2.462em 1005.1em 6.502em -999.997em); top: -4.739em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.214em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1001.93em 4.394em -999.997em); top: -5.208em; left: 0em;"><span class="mtd" id="MathJax-Span-551"><span class="mrow" id="MathJax-Span-552"><span class="msubsup" id="MathJax-Span-553"><span style="display: inline-block; position: relative; width: 1.057em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-554" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.34em 1000.59em 4.16em -999.997em); top: -4.33em; left: 0.53em;"><span class="mi" id="MathJax-Span-555" style="font-size: 70.7%; font-family: STIXGeneral;">⊤</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.399em 1000.3em 4.16em -999.997em); top: -3.744em; left: 0.53em;"><span class="mi" id="MathJax-Span-556" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-557"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-558"><span class="mrow" id="MathJax-Span-559"><span class="munderover" id="MathJax-Span-560"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-561" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-562" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-563" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(2.93em 1003.34em 4.394em -999.997em); top: -3.861em; left: 0em;"><span class="mtd" id="MathJax-Span-569"><span class="mrow" id="MathJax-Span-570"><span class="msubsup" id="MathJax-Span-571"><span style="display: inline-block; position: relative; width: 1.057em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-572" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.34em 1000.59em 4.16em -999.997em); top: -4.33em; left: 0.53em;"><span class="mi" id="MathJax-Span-573" style="font-size: 70.7%; font-family: STIXGeneral;">⊤</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.399em 1000.3em 4.16em -999.997em); top: -3.744em; left: 0.53em;"><span class="mi" id="MathJax-Span-574" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-575"><span style="display: inline-block; position: relative; width: 1.408em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1001em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-576"><span class="mrow" id="MathJax-Span-577"><span class="mtext" id="MathJax-Span-578" style="font-family: STIXGeneral; font-weight: bold;">W</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.998em;"><span class="mi" id="MathJax-Span-579" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-580"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-581"><span class="mrow" id="MathJax-Span-582"><span class="munderover" id="MathJax-Span-583"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-584" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-585" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-586" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(2.93em 1005.1em 4.335em -999.997em); top: -2.573em; left: 0em;"><span class="mtd" id="MathJax-Span-596"><span class="mrow" id="MathJax-Span-597"><span class="msubsup" id="MathJax-Span-598"><span style="display: inline-block; position: relative; width: 0.998em; height: 0px;"><span style="position: absolute; clip: rect(3.34em 1000.41em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-599" style="font-family: STIXGeneral; font-style: italic;">v</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.34em 1000.59em 4.16em -999.997em); top: -4.33em; left: 0.471em;"><span class="mi" id="MathJax-Span-600" style="font-size: 70.7%; font-family: STIXGeneral;">⊤</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.516em 1000.41em 4.16em -999.997em); top: -3.803em; left: 0.471em;"><span class="mi" id="MathJax-Span-601" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-602"><span style="display: inline-block; position: relative; width: 1.408em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1001em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-603"><span class="mrow" id="MathJax-Span-604"><span class="mtext" id="MathJax-Span-605" style="font-family: STIXGeneral; font-weight: bold;">W</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.998em;"><span class="mi" id="MathJax-Span-606" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-607" style="font-family: STIXGeneral;">[</span><span class="msubsup" id="MathJax-Span-608"><span style="display: inline-block; position: relative; width: 0.764em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-609" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-610" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-611" style="font-family: STIXGeneral;">;</span><span class="msubsup" id="MathJax-Span-612" style="padding-left: 0.179em;"><span style="display: inline-block; position: relative; width: 0.881em; height: 0px;"><span style="position: absolute; clip: rect(2.93em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="texatom" id="MathJax-Span-613"><span class="mrow" id="MathJax-Span-614"><span class="munderover" id="MathJax-Span-615"><span style="display: inline-block; position: relative; width: 0.53em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1000.47em 4.16em -999.997em); top: -3.978em; left: 0em;"><span class="mi" id="MathJax-Span-616" style="font-family: STIXGeneral; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.223em 1000.3em 3.633em -999.997em); top: -4.271em; left: 0.061em;"><span class="mo" id="MathJax-Span-617" style="font-family: STIXGeneral;">¯</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; top: -3.803em; left: 0.53em;"><span class="mi" id="MathJax-Span-618" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">s</span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span></span><span class="mo" id="MathJax-Span-619" style="font-family: STIXGeneral;">]</span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.745em;"></span></span><span style="position: absolute; clip: rect(2.286em 1003.11em 6.033em -999.997em); top: -4.388em; left: 6.326em;"><span style="display: inline-block; position: relative; width: 3.106em; height: 0px;"><span style="position: absolute; clip: rect(3.106em 1001.35em 4.16em -999.997em); top: -5.208em; left: 0em;"><span class="mtd" id="MathJax-Span-564"><span class="mrow" id="MathJax-Span-565"><span class="mi" id="MathJax-Span-566" style="font-family: STIXGeneral; font-style: italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-567" style="font-family: STIXGeneral; font-style: italic;">o</span><span class="mi" id="MathJax-Span-568" style="font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.106em 1003.11em 4.394em -999.997em); top: -3.861em; left: 0em;"><span class="mtd" id="MathJax-Span-587"><span class="mrow" id="MathJax-Span-588"><span class="mi" id="MathJax-Span-589" style="font-family: STIXGeneral; font-style: italic;">g</span><span class="mi" id="MathJax-Span-590" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mi" id="MathJax-Span-591" style="font-family: STIXGeneral; font-style: italic;">n</span><span class="mi" id="MathJax-Span-592" style="font-family: STIXGeneral; font-style: italic;">e</span><span class="mi" id="MathJax-Span-593" style="font-family: STIXGeneral; font-style: italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-594" style="font-family: STIXGeneral; font-style: italic;">a</span><span class="mi" id="MathJax-Span-595" style="font-family: STIXGeneral; font-style: italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span><span style="position: absolute; clip: rect(3.282em 1002.7em 4.16em -999.997em); top: -2.573em; left: 0em;"><span class="mtd" id="MathJax-Span-620"><span class="mrow" id="MathJax-Span-621"><span class="mi" id="MathJax-Span-622" style="font-family: STIXGeneral; font-style: italic;">c</span><span class="mi" id="MathJax-Span-623" style="font-family: STIXGeneral; font-style: italic;">o</span><span class="mi" id="MathJax-Span-624" style="font-family: STIXGeneral; font-style: italic;">n</span><span class="mi" id="MathJax-Span-625" style="font-family: STIXGeneral; font-style: italic;">c</span><span class="mi" id="MathJax-Span-626" style="font-family: STIXGeneral; font-style: italic;">a</span><span class="mi" id="MathJax-Span-627" style="font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.984em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.394em;"></span></span></span></span><span class="mo" id="MathJax-Span-628"></span></span></span><span style="display: inline-block; width: 0px; height: 4.453em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.068em; border-left: 0px solid; width: 0px; height: 4.718em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo stretchy="false">(</mo><msub><mi>h</mi><mi>t</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mi>s</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mrow><mo>{</mo><mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mtr><mtd><msubsup><mi>h</mi><mi>t</mi><mi mathvariant="normal">⊤</mi></msubsup><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mi>s</mi></msub></mtd><mtd><mi>d</mi><mi>o</mi><mi>t</mi></mtd></mtr><mtr><mtd><msubsup><mi>h</mi><mi>t</mi><mi mathvariant="normal">⊤</mi></msubsup><msub><mrow class="MJX-TeXAtom-ORD"><mtext mathvariant="bold">W</mtext></mrow><mi>a</mi></msub><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mi>s</mi></msub></mtd><mtd><mi>g</mi><mi>e</mi><mi>n</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi></mtd></mtr><mtr><mtd><msubsup><mi>v</mi><mi>a</mi><mi mathvariant="normal">⊤</mi></msubsup><msub><mrow class="MJX-TeXAtom-ORD"><mtext mathvariant="bold">W</mtext></mrow><mi>a</mi></msub><mo stretchy="false">[</mo><msub><mi>h</mi><mi>t</mi></msub><mo>;</mo><msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>h</mi><mo stretchy="false">¯</mo></mover></mrow><mi>s</mi></msub><mo stretchy="false">]</mo></mtd><mtd><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi></mtd></mtr></mtable><mo fence="true" stretchy="true" symmetric="true"></mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-45">
score(h_t, \bar h_s) =
\begin{cases}
h_t ^\top \bar h_s & dot \\
h_t ^\top \textbf{W}_a \bar h_s & general \\
v_a ^\top \textbf{W}_a [ h_t ; \bar h_s ] & concat
\end{cases}
</script></p>
<p>The modular definition of these scoring functions gives us an opportunity to build specific attention module that can switch between the different score methods. The input to this module is always the hidden state (of the decoder RNN) and set of encoder outputs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Attn</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">MAX_LENGTH</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Attn</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hidden_size</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'general'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'concat'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">):</span>
        <span class="n">seq_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encoder_outputs</span><span class="p">)</span>

        <span class="c1"># Create variable to store attention energies</span>
        <span class="n">attn_energies</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">seq_len</span><span class="p">))</span> <span class="c1"># B x 1 x S</span>
        <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span> <span class="n">attn_energies</span> <span class="o">=</span> <span class="n">attn_energies</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

        <span class="c1"># Calculate energies for each encoder output</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">seq_len</span><span class="p">):</span>
            <span class="n">attn_energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># Normalize energies to weights in range 0 to 1, resize to 1 x 1 x seq_len</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">attn_energies</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">encoder_output</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'dot'</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">hidden</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">encoder_output</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">energy</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'general'</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn</span><span class="p">(</span><span class="n">encoder_output</span><span class="p">)</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">hidden</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">energy</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'concat'</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">hidden</span><span class="p">,</span> <span class="n">encoder_output</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">energy</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can build a decoder that plugs this Attn module in after the RNN to calculate attention weights, and apply those weights to the encoder outputs to get a context vector.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">AttnDecoderRNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attn_model</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dropout_p</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AttnDecoderRNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1"># Keep parameters for reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attn_model</span> <span class="o">=</span> <span class="n">attn_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hidden_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">output_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">n_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout_p</span> <span class="o">=</span> <span class="n">dropout_p</span>
        
        <span class="c1"># Define layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gru</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
        
        <span class="c1"># Choose attention model</span>
        <span class="k">if</span> <span class="n">attn_model</span> <span class="o">!=</span> <span class="s1">'none'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attn</span> <span class="o">=</span> <span class="n">Attn</span><span class="p">(</span><span class="n">attn_model</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word_input</span><span class="p">,</span> <span class="n">last_context</span><span class="p">,</span> <span class="n">last_hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">):</span>
        <span class="c1"># Note: we run this one step at a time</span>
        
        <span class="c1"># Get the embedding of the current input word (last output word)</span>
        <span class="n">word_embedded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">word_input</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># S=1 x B x N</span>
        
        <span class="c1"># Combine embedded input word and last context, run through RNN</span>
        <span class="n">rnn_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">word_embedded</span><span class="p">,</span> <span class="n">last_context</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">rnn_output</span><span class="p">,</span> <span class="n">hidden</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gru</span><span class="p">(</span><span class="n">rnn_input</span><span class="p">,</span> <span class="n">last_hidden</span><span class="p">)</span>

        <span class="c1"># Calculate attention from current RNN state and all encoder outputs; apply to encoder outputs</span>
        <span class="n">attn_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn</span><span class="p">(</span><span class="n">rnn_output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">encoder_outputs</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">attn_weights</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span><span class="n">encoder_outputs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># B x 1 x N</span>
        
        <span class="c1"># Final output layer (next word prediction) using the RNN hidden state and context vector</span>
        <span class="n">rnn_output</span> <span class="o">=</span> <span class="n">rnn_output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># S=1 x B x N -&gt; B x N</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># B x S=1 x N -&gt; B x N</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">rnn_output</span><span class="p">,</span> <span class="n">context</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span>
        
        <span class="c1"># Return final output, hidden state, and attention weights (for visualization)</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">attn_weights</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Testing-the-models">Testing the models<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Testing-the-models">¶</a></h3><p>To make sure the Encoder and Decoder model are working (and working together) we'll do a quick test with fake word inputs:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encoder_test</span> <span class="o">=</span> <span class="n">EncoderRNN</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">decoder_test</span> <span class="o">=</span> <span class="n">AttnDecoderRNN</span><span class="p">(</span><span class="s1">'general'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encoder_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decoder_test</span><span class="p">)</span>

<span class="n">encoder_hidden</span> <span class="o">=</span> <span class="n">encoder_test</span><span class="o">.</span><span class="n">init_hidden</span><span class="p">()</span>
<span class="n">word_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span>
    <span class="n">encoder_test</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">word_input</span> <span class="o">=</span> <span class="n">word_input</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">encoder_outputs</span><span class="p">,</span> <span class="n">encoder_hidden</span> <span class="o">=</span> <span class="n">encoder_test</span><span class="p">(</span><span class="n">word_input</span><span class="p">,</span> <span class="n">encoder_hidden</span><span class="p">)</span>

<span class="n">word_inputs</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">decoder_attns</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">decoder_hidden</span> <span class="o">=</span> <span class="n">encoder_hidden</span>
<span class="n">decoder_context</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">decoder_test</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">))</span>

<span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span>
    <span class="n">decoder_test</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">word_inputs</span> <span class="o">=</span> <span class="n">word_inputs</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">decoder_context</span> <span class="o">=</span> <span class="n">decoder_context</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">decoder_output</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">decoder_attn</span> <span class="o">=</span> <span class="n">decoder_test</span><span class="p">(</span><span class="n">word_inputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">decoder_output</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">decoder_hidden</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">decoder_attn</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
    <span class="n">decoder_attns</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">decoder_attn</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>EncoderRNN (
  (embedding): Embedding(10, 10)
  (gru): GRU(10, 10, num_layers=2)
)
AttnDecoderRNN (
  (embedding): Embedding(10, 10)
  (gru): GRU(20, 10, num_layers=2, dropout=0.1)
  (out): Linear (20 -&gt; 10)
  (attn): Attn (
    (attn): Linear (10 -&gt; 10)
  )
)
torch.Size([1, 10]) torch.Size([2, 1, 10]) torch.Size([1, 1, 3])
torch.Size([1, 10]) torch.Size([2, 1, 10]) torch.Size([1, 1, 3])
torch.Size([1, 10]) torch.Size([2, 1, 10]) torch.Size([1, 1, 3])
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Training">Training<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Training">¶</a></h1><h2 id="Defining-a-training-iteration">Defining a training iteration<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Defining-a-training-iteration">¶</a></h2><p>To train we first run the input sentence through the encoder word by word, and keep track of every output and the latest hidden state. Next the decoder is given the last hidden state of the decoder as its first hidden state, and the <code>&lt;SOS&gt;</code> token as its first input. From there we iterate to predict a next token from the decoder.</p>
<h3 id="Teacher-Forcing-and-Scheduled-Sampling">Teacher Forcing and Scheduled Sampling<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Teacher-Forcing-and-Scheduled-Sampling">¶</a></h3><p>"Teacher Forcing", or maximum likelihood sampling, means using the real target outputs as each next input when training. The alternative is using the decoder's own guess as the next input. Using teacher forcing may cause the network to converge faster, but <a href="http://minds.jacobs-university.de/sites/default/files/uploads/papers/ESNTutorialRev.pdf">when the trained network is exploited, it may exhibit instability</a>.</p>
<p>You can observe outputs of teacher-forced networks that read with coherent grammar but wander far from the correct translation - you could think of it as having learned how to listen to the teacher's instructions, without learning how to venture out on its own.</p>
<p>The solution to the teacher-forcing "problem" is known as <a href="https://arxiv.org/abs/1506.03099">Scheduled Sampling</a>, which simply alternates between using the target values and predicted values when training. We will randomly choose to use teacher forcing with an if statement while training - sometimes we'll feed use real target as the input (ignoring the decoder's output), sometimes we'll use the decoder's output.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">teacher_forcing_ratio</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">clip</span> <span class="o">=</span> <span class="mf">5.0</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">input_variable</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="n">encoder_optimizer</span><span class="p">,</span> <span class="n">decoder_optimizer</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">MAX_LENGTH</span><span class="p">):</span>

    <span class="c1"># Zero gradients of both optimizers</span>
    <span class="n">encoder_optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">decoder_optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Added onto for each word</span>

    <span class="c1"># Get size of input and target sentences</span>
    <span class="n">input_length</span> <span class="o">=</span> <span class="n">input_variable</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">target_length</span> <span class="o">=</span> <span class="n">target_variable</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Run words through encoder</span>
    <span class="n">encoder_hidden</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">init_hidden</span><span class="p">()</span>
    <span class="n">encoder_outputs</span><span class="p">,</span> <span class="n">encoder_hidden</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">input_variable</span><span class="p">,</span> <span class="n">encoder_hidden</span><span class="p">)</span>
    
    <span class="c1"># Prepare input and output variables</span>
    <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="n">SOS_token</span><span class="p">]]))</span>
    <span class="n">decoder_context</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">decoder</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">))</span>
    <span class="n">decoder_hidden</span> <span class="o">=</span> <span class="n">encoder_hidden</span> <span class="c1"># Use last hidden state from encoder to start decoder</span>
    <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span>
        <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">decoder_input</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="n">decoder_context</span> <span class="o">=</span> <span class="n">decoder_context</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

    <span class="c1"># Choose whether to use teacher forcing</span>
    <span class="n">use_teacher_forcing</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">teacher_forcing_ratio</span>
    <span class="k">if</span> <span class="n">use_teacher_forcing</span><span class="p">:</span>
        
        <span class="c1"># Teacher forcing: Use the ground-truth target as the next input</span>
        <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target_length</span><span class="p">):</span>
            <span class="n">decoder_output</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">decoder_attention</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">decoder_input</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">+=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">decoder_output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_variable</span><span class="p">[</span><span class="n">di</span><span class="p">])</span>
            <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">target_variable</span><span class="p">[</span><span class="n">di</span><span class="p">]</span> <span class="c1"># Next target is next input</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Without teacher forcing: use network's own prediction as the next input</span>
        <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target_length</span><span class="p">):</span>
            <span class="n">decoder_output</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">decoder_attention</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">decoder_input</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">+=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">decoder_output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_variable</span><span class="p">[</span><span class="n">di</span><span class="p">])</span>
            
            <span class="c1"># Get most likely word index (highest value) from output</span>
            <span class="n">topv</span><span class="p">,</span> <span class="n">topi</span> <span class="o">=</span> <span class="n">decoder_output</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">topi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="n">ni</span><span class="p">]]))</span> <span class="c1"># Chosen word is next input</span>
            <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span> <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">decoder_input</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

            <span class="c1"># Stop at end of sentence (not necessary when using known targets)</span>
            <span class="k">if</span> <span class="n">ni</span> <span class="o">==</span> <span class="n">EOS_token</span><span class="p">:</span> <span class="k">break</span>

    <span class="c1"># Backpropagation</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clip_grad_norm</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">clip</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clip_grad_norm</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">clip</span><span class="p">)</span>
    <span class="n">encoder_optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">decoder_optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">target_length</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally helper functions to print time elapsed and estimated time remaining, given the current time and progress.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">as_minutes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">-=</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">60</span>
    <span class="k">return</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">m </span><span class="si">%d</span><span class="s1">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">time_since</span><span class="p">(</span><span class="n">since</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">since</span>
    <span class="n">es</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">percent</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">es</span> <span class="o">-</span> <span class="n">s</span>
    <span class="k">return</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> (- </span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="n">as_minutes</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">as_minutes</span><span class="p">(</span><span class="n">rs</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Running-training">Running training<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Running-training">¶</a></h2><p>With everything in place we can actually initialize a network and start training.</p>
<p>To start, we initialize models, optimizers, and a loss function (criterion).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">attn_model</span> <span class="o">=</span> <span class="s1">'general'</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">n_layers</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dropout_p</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Initialize models</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">EncoderRNN</span><span class="p">(</span><span class="n">input_lang</span><span class="o">.</span><span class="n">n_words</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">)</span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">AttnDecoderRNN</span><span class="p">(</span><span class="n">attn_model</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_lang</span><span class="o">.</span><span class="n">n_words</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">dropout_p</span><span class="o">=</span><span class="n">dropout_p</span><span class="p">)</span>

<span class="c1"># Move models to GPU</span>
<span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span>
    <span class="n">encoder</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">decoder</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="c1"># Initialize optimizers and criterion</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">encoder_optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
<span class="n">decoder_optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">NLLLoss</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then set up variables for plotting and tracking progress:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Configuring training</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">plot_every</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">print_every</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Keep track of time elapsed and running averages</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">plot_losses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">print_loss_total</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset every print_every</span>
<span class="n">plot_loss_total</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset every plot_every</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Starting job 591f9f701438c4613b4c4dc7 at 2017-05-20 03:02:21
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To actually train, we call the train function many times, printing a summary as we go.</p>
<p><em>Note:</em> If you run this notebook you can train, interrupt the kernel, evaluate, and continue training later. You can comment out the lines above where the encoder and decoder are initialized (so they aren't reset) or simply run the notebook starting from the following cell.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Begin!</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    
    <span class="c1"># Get training data for this cycle</span>
    <span class="n">training_pair</span> <span class="o">=</span> <span class="n">variables_from_pair</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">pairs</span><span class="p">))</span>
    <span class="n">input_variable</span> <span class="o">=</span> <span class="n">training_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">target_variable</span> <span class="o">=</span> <span class="n">training_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Run the train function</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">input_variable</span><span class="p">,</span> <span class="n">target_variable</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="n">encoder_optimizer</span><span class="p">,</span> <span class="n">decoder_optimizer</span><span class="p">,</span> <span class="n">criterion</span><span class="p">)</span>

    <span class="c1"># Keep track of loss</span>
    <span class="n">print_loss_total</span> <span class="o">+=</span> <span class="n">loss</span>
    <span class="n">plot_loss_total</span> <span class="o">+=</span> <span class="n">loss</span>

    <span class="k">if</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>

    <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">print_loss_avg</span> <span class="o">=</span> <span class="n">print_loss_total</span> <span class="o">/</span> <span class="n">print_every</span>
        <span class="n">print_loss_total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">print_summary</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%d</span><span class="s1"> </span><span class="si">%d%%</span><span class="s1">) </span><span class="si">%.4f</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">time_since</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">/</span> <span class="n">n_epochs</span><span class="p">),</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">/</span> <span class="n">n_epochs</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">print_loss_avg</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">print_summary</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="n">plot_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plot_loss_avg</span> <span class="o">=</span> <span class="n">plot_loss_total</span> <span class="o">/</span> <span class="n">plot_every</span>
        <span class="n">plot_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot_loss_avg</span><span class="p">)</span>
        <span class="n">plot_loss_total</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[log] 0m 42s (1000) 1.7562
0m 42s (- 35m 0s) (1000 2%) 3.2168
[log] 1m 28s (2000) 3.4178
1m 28s (- 35m 14s) (2000 4%) 2.8085
[log] 2m 13s (3000) 1.9268
2m 13s (- 34m 50s) (3000 6%) 2.6295
[log] 2m 59s (4000) 3.5481
2m 59s (- 34m 24s) (4000 8%) 2.5226
[log] 3m 45s (5000) 2.1306
3m 45s (- 33m 51s) (5000 10%) 2.3431
[log] 4m 31s (6000) 2.4112
4m 31s (- 33m 9s) (6000 12%) 2.2012
[log] 5m 16s (7000) 2.0306
5m 16s (- 32m 26s) (7000 14%) 2.1778
[log] 6m 3s (8000) 0.7172
6m 3s (- 31m 46s) (8000 16%) 2.0516
[log] 6m 49s (9000) 0.9867
6m 49s (- 31m 3s) (9000 18%) 1.9482
[log] 7m 35s (10000) 0.7058
7m 35s (- 30m 22s) (10000 20%) 1.8463
[log] 8m 22s (11000) 4.0532
8m 22s (- 29m 40s) (11000 22%) 1.8389
[log] 9m 8s (12000) 0.7909
9m 8s (- 28m 56s) (12000 24%) 1.7710
[log] 9m 53s (13000) 3.5531
9m 53s (- 28m 10s) (13000 26%) 1.6996
[log] 10m 40s (14000) 0.3723
10m 40s (- 27m 26s) (14000 28%) 1.6392
[log] 11m 27s (15000) 1.0735
11m 27s (- 26m 43s) (15000 30%) 1.5887
[log] 12m 13s (16000) 0.0578
12m 13s (- 25m 58s) (16000 32%) 1.5159
[log] 12m 59s (17000) 1.4627
12m 59s (- 25m 13s) (17000 34%) 1.4669
[log] 13m 46s (18000) 2.7408
13m 46s (- 24m 28s) (18000 36%) 1.3980
[log] 14m 33s (19000) 0.3085
14m 33s (- 23m 44s) (19000 38%) 1.3614
[log] 15m 19s (20000) 0.8777
15m 19s (- 22m 59s) (20000 40%) 1.3163
[log] 16m 6s (21000) 1.8394
16m 6s (- 22m 15s) (21000 42%) 1.2799
[log] 16m 53s (22000) 0.8656
16m 53s (- 21m 29s) (22000 44%) 1.2038
[log] 17m 39s (23000) 3.5788
17m 39s (- 20m 43s) (23000 46%) 1.1853
[log] 18m 26s (24000) 1.3385
18m 26s (- 19m 58s) (24000 48%) 1.1643
[log] 19m 12s (25000) 0.0158
19m 12s (- 19m 12s) (25000 50%) 1.1351
[log] 19m 59s (26000) 0.7937
19m 59s (- 18m 27s) (26000 52%) 1.1285
[log] 20m 46s (27000) 1.3123
20m 46s (- 17m 41s) (27000 54%) 1.0553
[log] 21m 32s (28000) 1.6989
21m 32s (- 16m 55s) (28000 56%) 1.0265
[log] 22m 18s (29000) 2.2208
22m 18s (- 16m 9s) (29000 57%) 0.9440
[log] 23m 4s (30000) 0.1320
23m 4s (- 15m 23s) (30000 60%) 0.9769
[log] 23m 51s (31000) 0.0043
23m 51s (- 14m 37s) (31000 62%) 0.9395
[log] 24m 37s (32000) 0.0119
24m 37s (- 13m 51s) (32000 64%) 0.8899
[log] 25m 23s (33000) 0.2071
25m 23s (- 13m 5s) (33000 66%) 0.9135
[log] 26m 10s (34000) 0.0169
26m 10s (- 12m 19s) (34000 68%) 0.8698
[log] 26m 57s (35000) 0.7662
26m 57s (- 11m 33s) (35000 70%) 0.8209
[log] 27m 43s (36000) 0.1208
27m 43s (- 10m 46s) (36000 72%) 0.7931
[log] 28m 29s (37000) 0.3535
28m 29s (- 10m 0s) (37000 74%) 0.7899
[log] 29m 15s (38000) 1.3398
29m 15s (- 9m 14s) (38000 76%) 0.7603
[log] 30m 2s (39000) 0.0115
30m 2s (- 8m 28s) (39000 78%) 0.7454
[log] 30m 48s (40000) 0.2135
30m 48s (- 7m 42s) (40000 80%) 0.6740
[log] 31m 34s (41000) 1.1087
31m 34s (- 6m 55s) (41000 82%) 0.6738
[log] 32m 20s (42000) 0.0262
32m 20s (- 6m 9s) (42000 84%) 0.6659
[log] 33m 7s (43000) 1.2855
33m 7s (- 5m 23s) (43000 86%) 0.7443
[log] 33m 54s (44000) 0.0022
33m 54s (- 4m 37s) (44000 88%) 0.6427
[log] 34m 40s (45000) 0.5267
34m 40s (- 3m 51s) (45000 90%) 0.6092
[log] 35m 27s (46000) 0.0068
35m 27s (- 3m 4s) (46000 92%) 0.6172
[log] 36m 12s (47000) 0.5520
36m 12s (- 2m 18s) (47000 94%) 0.6145
[log] 36m 59s (48000) 0.0185
36m 59s (- 1m 32s) (48000 96%) 0.5903
[log] 37m 46s (49000) 0.0026
37m 46s (- 0m 46s) (49000 98%) 0.6131
[log] 38m 32s (50000) 0.0138
38m 32s (- 0m 0s) (50000 100%) 0.5403
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting-training-loss">Plotting training loss<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Plotting-training-loss">¶</a></h2><p>Plotting is done with matplotlib, using the array <code>plot_losses</code> that was created while training.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># put ticks at regular intervals</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

<span class="n">show_plot</span><span class="p">(</span><span class="n">plot_losses</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>&lt;matplotlib.figure.Figure at 0x7fae93740828&gt;</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Evaluating-the-network">Evaluating the network<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Evaluating-the-network">¶</a></h1><p>Evaluation is mostly the same as training, but there are no targets. Instead we always feed the decoder's predictions back to itself. Every time it predicts a word, we add it to the output string. If it predicts the EOS token we stop there. We also store the decoder's attention outputs for each step to display later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">MAX_LENGTH</span><span class="p">):</span>
    <span class="n">input_variable</span> <span class="o">=</span> <span class="n">variable_from_sentence</span><span class="p">(</span><span class="n">input_lang</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span>
    <span class="n">input_length</span> <span class="o">=</span> <span class="n">input_variable</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Run through encoder</span>
    <span class="n">encoder_hidden</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">init_hidden</span><span class="p">()</span>
    <span class="n">encoder_outputs</span><span class="p">,</span> <span class="n">encoder_hidden</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">input_variable</span><span class="p">,</span> <span class="n">encoder_hidden</span><span class="p">)</span>

    <span class="c1"># Create starting vectors for decoder</span>
    <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="n">SOS_token</span><span class="p">]]))</span> <span class="c1"># SOS</span>
    <span class="n">decoder_context</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">decoder</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span>
        <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">decoder_input</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="n">decoder_context</span> <span class="o">=</span> <span class="n">decoder_context</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

    <span class="n">decoder_hidden</span> <span class="o">=</span> <span class="n">encoder_hidden</span>
    
    <span class="n">decoded_words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">decoder_attentions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_length</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span>
    
    <span class="c1"># Run through decoder</span>
    <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
        <span class="n">decoder_output</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">decoder_attention</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">decoder_input</span><span class="p">,</span> <span class="n">decoder_context</span><span class="p">,</span> <span class="n">decoder_hidden</span><span class="p">,</span> <span class="n">encoder_outputs</span><span class="p">)</span>
        <span class="n">decoder_attentions</span><span class="p">[</span><span class="n">di</span><span class="p">,:</span><span class="n">decoder_attention</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">decoder_attention</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Choose top word from output</span>
        <span class="n">topv</span><span class="p">,</span> <span class="n">topi</span> <span class="o">=</span> <span class="n">decoder_output</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="n">topi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ni</span> <span class="o">==</span> <span class="n">EOS_token</span><span class="p">:</span>
            <span class="n">decoded_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'&lt;EOS&gt;'</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decoded_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_lang</span><span class="o">.</span><span class="n">index2word</span><span class="p">[</span><span class="n">ni</span><span class="p">])</span>
            
        <span class="c1"># Next input is chosen word</span>
        <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="n">ni</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="n">USE_CUDA</span><span class="p">:</span> <span class="n">decoder_input</span> <span class="o">=</span> <span class="n">decoder_input</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">decoded_words</span><span class="p">,</span> <span class="n">decoder_attentions</span><span class="p">[:</span><span class="n">di</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">encoder_outputs</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can evaluate random sentences from the training set and print out the input, target, and output to make some subjective quality judgements:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">evaluate_randomly</span><span class="p">():</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
    
    <span class="n">output_words</span><span class="p">,</span> <span class="n">decoder_attn</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">output_sentence</span> <span class="o">=</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_words</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">'&gt;'</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'='</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'&lt;'</span><span class="p">,</span> <span class="n">output_sentence</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluate_randomly</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&gt; je suis ambitieux .
= i m ambitious .
&lt; i m ambitious . &lt;EOS&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Visualizing-attention">Visualizing attention<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Visualizing-attention">¶</a></h1><p>A useful property of the attention mechanism is its highly interpretable outputs. Because it is used to weight specific encoder outputs of the input sequence, we can imagine looking where the network is focused most at each time step.</p>
<p>You could simply run <code>plt.matshow(attentions)</code> to see attention output displayed as a matrix, with the columns being input steps and rows being output steps:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_words</span><span class="p">,</span> <span class="n">attentions</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="s2">"je suis trop froid ."</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">attentions</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a better viewing experience we will do the extra work of adding axes and labels:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">show_attention</span><span class="p">(</span><span class="n">input_sentence</span><span class="p">,</span> <span class="n">output_words</span><span class="p">,</span> <span class="n">attentions</span><span class="p">):</span>
    <span class="c1"># Set up figure with colorbar</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">attentions</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'bone'</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>

    <span class="c1"># Set up axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">''</span><span class="p">]</span> <span class="o">+</span> <span class="n">input_sentence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'&lt;EOS&gt;'</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">''</span><span class="p">]</span> <span class="o">+</span> <span class="n">output_words</span><span class="p">)</span>

    <span class="c1"># Show label at every tick</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">evaluate_and_show_attention</span><span class="p">(</span><span class="n">input_sentence</span><span class="p">):</span>
    <span class="n">output_words</span><span class="p">,</span> <span class="n">attentions</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">input_sentence</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'input ='</span><span class="p">,</span> <span class="n">input_sentence</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'output ='</span><span class="p">,</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_words</span><span class="p">))</span>
    <span class="n">show_attention</span><span class="p">(</span><span class="n">input_sentence</span><span class="p">,</span> <span class="n">output_words</span><span class="p">,</span> <span class="n">attentions</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluate_and_show_attention</span><span class="p">(</span><span class="s2">"elle a cinq ans de moins que moi ."</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>input = elle a cinq ans de moins que moi .
output = she s five years younger than me . &lt;EOS&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluate_and_show_attention</span><span class="p">(</span><span class="s2">"elle est trop petit ."</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>input = elle est trop petit .
output = she s too short . &lt;EOS&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluate_and_show_attention</span><span class="p">(</span><span class="s2">"je ne crains pas de mourir ."</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>input = je ne crains pas de mourir .
output = i m not scared to die . &lt;EOS&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluate_and_show_attention</span><span class="p">(</span><span class="s2">"c est un jeune directeur plein de talent ."</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>input = c est un jeune directeur plein de talent .
output = he s a very young young . &lt;EOS&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Exercises">Exercises<a class="anchor-link" href="http://nbviewer.jupyter.org/github/spro/practical-pytorch/blob/master/seq2seq-translation/seq2seq-translation.ipynb#Exercises">¶</a></h1><ul>
<li>Try with a different dataset<ul>
<li>Another language pair</li>
<li>Human → Machine (e.g. IOT commands)</li>
<li>Chat → Response</li>
<li>Question → Answer</li>
</ul>
</li>
<li>Replace the embedding pre-trained word embeddings such as word2vec or GloVe</li>
<li>Try with more layers, more hidden units, and more sentences. Compare the training time and results.</li>
<li>If you use a translation file where pairs have two of the same phrase (<code>I am test \t I am test</code>), you can use this as an autoencoder. Try this:<ul>
<li>Train as an autoencoder</li>
<li>Save only the Encoder network</li>
<li>Train a new Decoder for translation from there</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
 


    </div>
  </div>

  </div>


  
    <footer class="footer hidden-print">
      <div class="container">
        <div class="col-md-4">
          <p>
            This website does not host notebooks, it only renders notebooks
            available on other websites.
          </p>
        </div>

        <div class="col-md-4">
          <p>
            Delivered by <a href="http://www.fastly.com/">Fastly</a>,
            Rendered by <a href="https://developer.rackspace.com/?nbviewer=awesome">Rackspace</a>
          </p>
          <p>
            nbviewer GitHub <a href="https://github.com/jupyter/nbviewer">repository</a>.
          </p>
        </div>

        <div class="col-md-4">
          
  
            
              <p>
                nbviewer version:
                <a href="https://github.com/jupyter/nbviewer/commit/89297bd5c4de8e27e009971b5ede1bbc369fbb05">
                  89297bd
                </a>
              </p>
            
          
  
  <p>
    nbconvert version: <a href="https://github.com/jupyter/nbconvert/releases/tag/5.3.1">
      5.3.1
    </a>
  </p>
  

          
  
  
  <p>
    Rendered
    <span class="date" data-date="Sat, 16 Sep 2017 01:17:10 UTC" title="Sat, 16 Sep 2017 01:17:10 UTC">10 hours ago</span>
  </p>
  

        </div>
      </div>
    </footer>
  

  <script src="./Jupyter Notebook Viewer_files/embed.js"></script>
  <script src="./Jupyter Notebook Viewer_files/bootstrap.min.js"></script>
  <script src="./Jupyter Notebook Viewer_files/headroom.min.js"></script>
  <script src="./Jupyter Notebook Viewer_files/jQuery.headroom.min.js"></script>

  
  
  <script>
    $(function(){ $("#menubar").headroom({
      tolerance: 5,
      offset: 205,
      classes: {
        initial: "animated",
        pinned: "slideInDown",
        unpinned: "slideOutUp"
      }
    })});
  </script>


  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-52617120-5', 'auto');
    ga('send', 'pageview');
  </script>
  
  <script>
    require({
        paths: {
          moment: "/static/components/moment/min/moment.min.js?v=89f87298ad94aa1e6b92f42eb66da043"
        }
      }, ["moment"], function(moment){
      var date = $("footer .date"),
        m = moment(new Date(date.data('date'))),
        update = function(){ date.text(m.fromNow()); };
      setInterval(update, 61*1000);
      update();
      var w = $(window).scroll(function(event){
        $("body").toggleClass("scrolled", w.scrollTop() > 0);
      });
    });
  </script>
  <!--NEW RELIC Stop Perf Measurement-->
  
  <!--NEW RELIC End-->

<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: STIXSizeOneSym, sans-serif;"></div></div></body></html>